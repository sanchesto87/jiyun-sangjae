(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[5],{"1mwW":function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return ic})),n.d(e,"b",(function(){return uc})),n.d(e,"c",(function(){return pc})),n.d(e,"d",(function(){return vc})),n.d(e,"e",(function(){return sc})),n.d(e,"f",(function(){return rc})),n.d(e,"g",(function(){return hc})),n.d(e,"h",(function(){return bc})),n.d(e,"i",(function(){return gc})),n.d(e,"j",(function(){return Vu})),n.d(e,"k",(function(){return _c})),n.d(e,"l",(function(){return T})),n.d(e,"m",(function(){return Uu})),n.d(e,"n",(function(){return Ec})),n.d(e,"o",(function(){return ac})),n.d(e,"p",(function(){return Tc})),n.d(e,"q",(function(){return Ic})),n.d(e,"r",(function(){return Yu})),n.d(e,"s",(function(){return nc})),n.d(e,"t",(function(){return yc}));var r=n("qOnz"),i=n("q/0M"),o=n("x7I3"),s=n("mrSG"),u=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();u.o=-1;var a={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},c=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(s.c)(e,t),e}(Error),h=new i.b("@firebase/firestore");function f(){return h.logLevel}function l(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(h.logLevel<=i.a.DEBUG){var r=e.map(y);h.debug.apply(h,Object(s.f)(["Firestore (8.4.0): "+t],r))}}function d(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(h.logLevel<=i.a.ERROR){var r=e.map(y);h.error.apply(h,Object(s.f)(["Firestore (8.4.0): "+t],r))}}function p(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(h.logLevel<=i.a.WARN){var r=e.map(y);h.warn.apply(h,Object(s.f)(["Firestore (8.4.0): "+t],r))}}function y(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function v(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.4.0) INTERNAL ASSERTION FAILED: "+t;throw d(e),new Error(e)}function m(t,e){t||v()}function g(t,e){return t}function b(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var w=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=b(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function I(t,e){return t<e?-1:t>e?1:0}function _(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function E(t){return t+"\0"}var T=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new c(a.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new c(a.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new c(a.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new c(a.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?I(this.nanoseconds,t.nanoseconds):I(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),O=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new T(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function S(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function D(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function N(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var A=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&v(),void 0===n?n=t.length-e:n>t.length-e&&v(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),k=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(s.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new c(a.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter((function(t){return t.length>0})))}return new e(r)},e.emptyPath=function(){return new e([])},e}(A),j=/^[_a-zA-Z][_a-zA-Z0-9]*$/,x=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(s.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return j.test(t)},e.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new c(a.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var u=t[i];if("\\"===u){if(i+1===t.length)throw new c(a.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var h=t[i+1];if("\\"!==h&&"."!==h&&"`"!==h)throw new c(a.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=h,i+=2}else"`"===u?(s=!s,i++):"."!==u||s?(r+=u,i++):(o(),i++)}if(o(),s)throw new c(a.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(A),C=function(){function t(t){this.fields=t,t.sort(x.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return _(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),R=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return I(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();R.EMPTY_BYTE_STRING=new R("");var L=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function P(t){if(m(!!t),"string"==typeof t){var e=0,n=L.exec(t);if(m(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:M(t.seconds),nanos:M(t.nanos)}}function M(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function F(t){return"string"==typeof t?R.fromBase64String(t):R.fromUint8Array(t)}function q(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function V(t){var e=t.mapValue.fields.__previous_value__;return q(e)?V(e):e}function U(t){var e=P(t.mapValue.fields.__local_write_time__.timestampValue);return new T(e.seconds,e.nanos)}function B(t){return null==t}function K(t){return 0===t&&1/t==-1/0}function G(t){return"number"==typeof t&&Number.isInteger(t)&&!K(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Q=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(k.fromString(e))},t.fromName=function(e){return new t(k.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===k.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return k.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new k(e.slice()))},t}();function z(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?q(t)?4:10:v()}function W(t,e){var n=z(t);if(n!==z(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return U(t).isEqual(U(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=P(t.timestampValue),r=P(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return F(t.bytesValue).isEqual(F(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return M(t.geoPointValue.latitude)===M(e.geoPointValue.latitude)&&M(t.geoPointValue.longitude)===M(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return M(t.integerValue)===M(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=M(t.doubleValue),r=M(e.doubleValue);return n===r?K(n)===K(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return _(t.arrayValue.values||[],e.arrayValue.values||[],W);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(S(n)!==S(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!W(n[i],r[i])))return!1;return!0}(t,e);default:return v()}}function H(t,e){return void 0!==(t.values||[]).find((function(t){return W(t,e)}))}function Y(t,e){var n=z(t),r=z(e);if(n!==r)return I(n,r);switch(n){case 0:return 0;case 1:return I(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=M(t.integerValue||t.doubleValue),r=M(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return X(t.timestampValue,e.timestampValue);case 4:return X(U(t),U(e));case 5:return I(t.stringValue,e.stringValue);case 6:return function(t,e){var n=F(t),r=F(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=I(n[i],r[i]);if(0!==o)return o}return I(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=I(M(t.latitude),M(e.latitude));return 0!==n?n:I(M(t.longitude),M(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Y(n[i],r[i]);if(o)return o}return I(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=I(r[s],o[s]);if(0!==u)return u;var a=Y(n[r[s]],i[o[s]]);if(0!==a)return a}return I(r.length,o.length)}(t.mapValue,e.mapValue);default:throw v()}}function X(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return I(t,e);var n=P(t),r=P(e),i=I(n.seconds,r.seconds);return 0!==i?i:I(n.nanos,r.nanos)}function $(t){return J(t)}function J(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=P(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?F(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,Q.fromName(n).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=J(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+J(t.fields[o])}return e+"}"}(t.mapValue):v();var e,n}function Z(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function tt(t){return!!t&&"integerValue"in t}function et(t){return!!t&&"arrayValue"in t}function nt(t){return!!t&&"nullValue"in t}function rt(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function it(t){return!!t&&"mapValue"in t}var ot=function(){function t(t){this.overlayMap=new Map,this.partialValue=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(e){return t.extractNestedValue(this.buildProto(),e)},t.prototype.toProto=function(){return this.field(x.emptyPath())},t.prototype.set=function(t,e){this.setOverlay(t,e)},t.prototype.setAll=function(t){var e=this;t.forEach((function(t,n){t?e.set(n,t):e.delete(n)}))},t.prototype.delete=function(t){this.setOverlay(t,null)},t.prototype.isEqual=function(t){return W(this.buildProto(),t.buildProto())},t.prototype.setOverlay=function(t,e){for(var n=this.overlayMap,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===z(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.lastSegment(),e)},t.prototype.applyOverlay=function(e,n){var r=this,i=!1,o=t.extractNestedValue(this.partialValue,e),s=it(o)?Object.assign({},o.mapValue.fields):{};return n.forEach((function(t,n){if(t instanceof Map){var o=r.applyOverlay(e.child(n),t);null!=o&&(s[n]=o,i=!0)}else null!==t?(s[n]=t,i=!0):s.hasOwnProperty(n)&&(delete s[n],i=!0)})),i?{mapValue:{fields:s}}:null},t.prototype.buildProto=function(){var t=this.applyOverlay(x.emptyPath(),this.overlayMap);return null!=t&&(this.partialValue=t,this.overlayMap.clear()),this.partialValue},t.extractNestedValue=function(t,e){if(e.isEmpty())return t;for(var n=t,r=0;r<e.length-1;++r){if(!n.mapValue.fields)return null;if(!it(n=n.mapValue.fields[e.get(r)]))return null}return(n=(n.mapValue.fields||{})[e.lastSegment()])||null},t.prototype.clone=function(){return new t(this.buildProto())},t}();function st(t){var e=[];return D(t.fields||{},(function(t,n){var r=new x([t]);if(it(n)){var i=st(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var u=s[o];e.push(r.child(u))}}else e.push(r)})),new C(e)}var ut=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,O.min(),ot.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,ot.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,ot.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=ot.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=ot.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.toProto())+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),at=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function ct(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new at(t,e,n,r,i,o,s)}function ht(t){var e=g(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.canonicalString()+t.op.toString()+$(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return function(t){return t.field.canonicalString()+t.dir}(t)})).join(","),B(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Et(e.startAt)),e.endAt&&(n+="|ub:",n+=Et(e.endAt)),e.h=n}return e.h}function ft(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Ot(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!W(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Dt(t.startAt,e.startAt)&&Dt(t.endAt,e.endAt)}function lt(t){return Q.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var dt=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(s.c)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new pt(t,n,r):"array-contains"===n?new gt(t,r):"in"===n?new bt(t,r):"not-in"===n?new wt(t,r):"array-contains-any"===n?new It(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new yt(t,n):new vt(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(Y(e,this.value)):null!==e&&z(this.value)===z(e)&&this.m(Y(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return v()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}((function(){})),pt=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=Q.fromName(r.referenceValue),i}return Object(s.c)(e,t),e.prototype.matches=function(t){var e=Q.comparator(t.key,this.key);return this.m(e)},e}(dt),yt=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=mt("in",n),r}return Object(s.c)(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(dt),vt=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=mt("not-in",n),r}return Object(s.c)(e,t),e.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},e}(dt);function mt(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return Q.fromName(t.referenceValue)}))}var gt=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(s.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return et(e)&&H(e.arrayValue,this.value)},e}(dt),bt=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(s.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&H(this.value.arrayValue,e)},e}(dt),wt=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(s.c)(e,t),e.prototype.matches=function(t){if(H(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!H(this.value.arrayValue,e)},e}(dt),It=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(s.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!et(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return H(e.value.arrayValue,t)}))},e}(dt),_t=function(t,e){this.position=t,this.before=e};function Et(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return $(t)})).join(",")}var Tt=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Ot(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function St(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?Q.comparator(Q.fromName(s.referenceValue),n.key):Y(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Dt(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!W(t.position[n],e.position[n]))return!1;return!0}var Nt=function(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=u,this.p=null,this.T=null,this.startAt,this.endAt};function At(t,e,n,r,i,o,s,u){return new Nt(t,e,n,r,i,o,s,u)}function kt(t){return new Nt(t)}function jt(t){return!B(t.limit)&&"F"===t.limitType}function xt(t){return!B(t.limit)&&"L"===t.limitType}function Ct(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Rt(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Lt(t){return null!==t.collectionGroup}function Pt(t){var e=g(t);if(null===e.p){e.p=[];var n=Rt(e),r=Ct(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new Tt(n)),e.p.push(new Tt(x.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var u=s[o];e.p.push(u),u.field.isKeyField()&&(i=!0)}if(!i){var a=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new Tt(x.keyField(),a))}}}return e.p}function Mt(t){var e=g(t);if(!e.T)if("F"===e.limitType)e.T=ct(e.path,e.collectionGroup,Pt(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Pt(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new Tt(o.field,s))}var u=e.endAt?new _t(e.endAt.position,!e.endAt.before):null,a=e.startAt?new _t(e.startAt.position,!e.startAt.before):null;e.T=ct(e.path,e.collectionGroup,n,e.filters,e.limit,u,a)}return e.T}function Ft(t,e,n){return new Nt(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function qt(t,e){return ft(Mt(t),Mt(e))&&t.limitType===e.limitType}function Vt(t){return ht(Mt(t))+"|lt:"+t.limitType}function Ut(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.canonicalString()+" "+e.op+" "+$(e.value);var e})).join(", ")+"]"),B(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Et(t.startAt)),t.endAt&&(e+=", endAt: "+Et(t.endAt)),"Target("+e+")"}(Mt(t))+"; limitType="+t.limitType+")"}function Bt(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Q.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!St(t.startAt,Pt(t),e))&&(!t.endAt||!St(t.endAt,Pt(t),e))}(t,e)}function Kt(t){return function(e,n){for(var r=!1,i=0,o=Pt(t);i<o.length;i++){var s=o[i],u=Gt(s,e,n);if(0!==u)return u;r=r||s.field.isKeyField()}return 0}}function Gt(t,e,n){var r=t.field.isKeyField()?Q.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Y(r,i):v()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return v()}}function Qt(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:K(e)?"-0":e}}function zt(t){return{integerValue:""+t}}function Wt(t,e){return G(e)?zt(e):Qt(t,e)}var Ht=function(){this._=void 0};function Yt(t,e,n){return t instanceof Jt?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Zt?te(t,e):t instanceof ee?ne(t,e):function(t,e){var n=$t(t,e),r=ie(n)+ie(t.A);return tt(n)&&tt(t.A)?zt(r):Qt(t.R,r)}(t,e)}function Xt(t,e,n){return t instanceof Zt?te(t,e):t instanceof ee?ne(t,e):n}function $t(t,e){return t instanceof re?tt(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var Jt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(s.c)(e,t),e}(Ht),Zt=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(s.c)(e,t),e}(Ht);function te(t,e){for(var n=oe(e),r=function(t){n.some((function(e){return W(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ee=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(s.c)(e,t),e}(Ht);function ne(t,e){for(var n=oe(e),r=function(t){n=n.filter((function(e){return!W(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var re=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return Object(s.c)(e,t),e}(Ht);function ie(t){return M(t.integerValue||t.doubleValue)}function oe(t){return et(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var se=function(t,e){this.field=t,this.transform=e},ue=function(t,e){this.version=t,this.transformResults=e},ae=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function ce(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var he=function(){};function fe(t,e,n){t instanceof ve?function(t,e,n){var r=t.value.clone(),i=be(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof me?function(t,e,n){if(ce(t.precondition,e)){var r=be(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(ge(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function le(t,e,n){t instanceof ve?function(t,e,n){if(ce(t.precondition,e)){var r=t.value.clone(),i=we(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(ye(e),r).setHasLocalMutations()}}(t,e,n):t instanceof me?function(t,e,n){if(ce(t.precondition,e)){var r=we(t.fieldTransforms,n,e),i=e.data;i.setAll(ge(t)),i.setAll(r),e.convertToFoundDocument(ye(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){ce(t.precondition,e)&&e.convertToNoDocument(O.min())}(t,e)}function de(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),u=$t(o.transform,s||null);null!=u&&(null==n&&(n=ot.empty()),n.set(o.field,u))}return n||null}function pe(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&_(t,e,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Zt&&e instanceof Zt||t instanceof ee&&e instanceof ee?_(t.elements,e.elements,W):t instanceof re&&e instanceof re?W(t.A,e.A):t instanceof Jt&&e instanceof Jt}(t.transform,e.transform)}(t,e)}))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function ye(t){return t.isFoundDocument()?t.version:O.min()}var ve=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return Object(s.c)(e,t),e}(he),me=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return Object(s.c)(e,t),e}(he);function ge(t){var e=new Map;return t.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}})),e}function be(t,e,n){var r=new Map;m(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,u=e.data.field(o.field);r.set(o.field,Xt(s,u,n[i]))}return r}function we(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],u=s.transform,a=n.data.field(s.field);r.set(s.field,Yt(u,a,e))}return r}var Ie,_e,Ee=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return Object(s.c)(e,t),e}(he),Te=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return Object(s.c)(e,t),e}(he),Oe=function(t){this.count=t};function Se(t){switch(t){case a.OK:return v();case a.CANCELLED:case a.UNKNOWN:case a.DEADLINE_EXCEEDED:case a.RESOURCE_EXHAUSTED:case a.INTERNAL:case a.UNAVAILABLE:case a.UNAUTHENTICATED:return!1;case a.INVALID_ARGUMENT:case a.NOT_FOUND:case a.ALREADY_EXISTS:case a.PERMISSION_DENIED:case a.FAILED_PRECONDITION:case a.ABORTED:case a.OUT_OF_RANGE:case a.UNIMPLEMENTED:case a.DATA_LOSS:return!0;default:return v()}}function De(t){if(void 0===t)return d("GRPC error has no .code"),a.UNKNOWN;switch(t){case Ie.OK:return a.OK;case Ie.CANCELLED:return a.CANCELLED;case Ie.UNKNOWN:return a.UNKNOWN;case Ie.DEADLINE_EXCEEDED:return a.DEADLINE_EXCEEDED;case Ie.RESOURCE_EXHAUSTED:return a.RESOURCE_EXHAUSTED;case Ie.INTERNAL:return a.INTERNAL;case Ie.UNAVAILABLE:return a.UNAVAILABLE;case Ie.UNAUTHENTICATED:return a.UNAUTHENTICATED;case Ie.INVALID_ARGUMENT:return a.INVALID_ARGUMENT;case Ie.NOT_FOUND:return a.NOT_FOUND;case Ie.ALREADY_EXISTS:return a.ALREADY_EXISTS;case Ie.PERMISSION_DENIED:return a.PERMISSION_DENIED;case Ie.FAILED_PRECONDITION:return a.FAILED_PRECONDITION;case Ie.ABORTED:return a.ABORTED;case Ie.OUT_OF_RANGE:return a.OUT_OF_RANGE;case Ie.UNIMPLEMENTED:return a.UNIMPLEMENTED;case Ie.DATA_LOSS:return a.DATA_LOSS;default:return v()}}(_e=Ie||(Ie={}))[_e.OK=0]="OK",_e[_e.CANCELLED=1]="CANCELLED",_e[_e.UNKNOWN=2]="UNKNOWN",_e[_e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",_e[_e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",_e[_e.NOT_FOUND=5]="NOT_FOUND",_e[_e.ALREADY_EXISTS=6]="ALREADY_EXISTS",_e[_e.PERMISSION_DENIED=7]="PERMISSION_DENIED",_e[_e.UNAUTHENTICATED=16]="UNAUTHENTICATED",_e[_e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",_e[_e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",_e[_e.ABORTED=10]="ABORTED",_e[_e.OUT_OF_RANGE=11]="OUT_OF_RANGE",_e[_e.UNIMPLEMENTED=12]="UNIMPLEMENTED",_e[_e.INTERNAL=13]="INTERNAL",_e[_e.UNAVAILABLE=14]="UNAVAILABLE",_e[_e.DATA_LOSS=15]="DATA_LOSS";var Ne=function(){function t(t,e){this.comparator=t,this.root=e||ke.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,ke.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ke.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Ae(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Ae(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Ae(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Ae(this.root,t,this.comparator,!0)},t}(),Ae=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),ke=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw v();if(this.right.isRed())throw v();var t=this.left.check();if(t!==this.right.check())throw v();return t+(this.isRed()?0:1)},t}();ke.EMPTY=null,ke.RED=!0,ke.BLACK=!1,ke.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw v()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw v()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw v()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw v()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw v()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new ke(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var je=function(){function t(t){this.comparator=t,this.data=new Ne(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new xe(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new xe(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),xe=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Ce=new Ne(Q.comparator);function Re(){return Ce}var Le=new Ne(Q.comparator);function Pe(){return Le}var Me=new Ne(Q.comparator);function Fe(){return Me}var qe=new je(Q.comparator);function Ve(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=qe,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Ue=new je(I);function Be(){return Ue}var Ke=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,Ge.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(O.min(),r,Be(),Re(),Ve())},t}(),Ge=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(R.EMPTY_BYTE_STRING,n,Ve(),Ve(),Ve())},t}(),Qe=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},ze=function(t,e){this.targetId=t,this.V=e},We=function(t,e,n,r){void 0===n&&(n=R.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},He=function(){function t(){this.S=0,this.D=$e(),this.C=R.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"O",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.$=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=Ve(),e=Ve(),n=Ve();return this.D.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:v()}})),new Ge(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=$e()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),Ye=function(){function t(t){this.W=t,this.G=new Map,this.H=Re(),this.J=Xe(),this.Y=new je(I)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.tt(r,t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.$(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.$(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.$(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.$(t.resumeToken));break;default:v()}}))},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach((function(t,r){n.st(r)&&e(r)}))},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(lt(i))if(0===n){var o=new Q(i.path);this.tt(e,o,ut.newNoDocument(o,O.min()))}else m(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach((function(r,i){var o=e.ot(i);if(o){if(r.current&&lt(o.target)){var s=new Q(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,ut.newNoDocument(s,t))}r.O&&(n.set(i,r.M()),r.L())}}));var r=Ve();this.J.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new Ke(t,n,this.Y,this.H,r);return this.H=Re(),this.J=Xe(),this.Y=new je(I),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new He,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new je(I),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||l("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new He),this.W.getRemoteKeysForTarget(t).forEach((function(n){e.tt(t,n,null)}))},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function Xe(){return new Ne(Q.comparator)}function $e(){return new Ne(Q.comparator)}var Je={asc:"ASCENDING",desc:"DESCENDING"},Ze={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},tn=function(t,e){this.databaseId=t,this.I=e};function en(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function nn(t,e){return t.I?e.toBase64():e.toUint8Array()}function rn(t,e){return en(t,e.toTimestamp())}function on(t){return m(!!t),O.fromTimestamp(function(t){var e=P(t);return new T(e.seconds,e.nanos)}(t))}function sn(t,e){return function(t){return new k(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function un(t){var e=k.fromString(t);return m(jn(e)),e}function an(t,e){return sn(t.databaseId,e.path)}function cn(t,e){var n=un(e);if(n.get(1)!==t.databaseId.projectId)throw new c(a.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new c(a.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Q(dn(n))}function hn(t,e){return sn(t.databaseId,e)}function fn(t){var e=un(t);return 4===e.length?k.emptyPath():dn(e)}function ln(t){return new k(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function dn(t){return m(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function pn(t,e,n){return{name:an(t,e),fields:n.toProto().mapValue.fields}}function yn(t,e,n){var r=cn(t,e.name),i=on(e.updateTime),o=new ot({mapValue:{fields:e.fields}}),s=ut.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function vn(t,e){var n;if(e instanceof ve)n={update:pn(t,e.key,e.value)};else if(e instanceof Ee)n={delete:an(t,e.key)};else if(e instanceof me)n={update:pn(t,e.key,e.data),updateMask:kn(e.fieldMask)};else{if(!(e instanceof Te))return v();n={verify:an(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof Jt)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Zt)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ee)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof re)return{fieldPath:e.field.canonicalString(),increment:n.A};throw v()}(0,t)}))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:rn(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:v()}(t,e.precondition)),n}function mn(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?ae.updateTime(on(t.updateTime)):void 0!==t.exists?ae.exists(t.exists):ae.none()}(e.currentDocument):ae.none(),r=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)m("REQUEST_TIME"===e.setToServerValue),n=new Jt;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new Zt(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new ee(i)}else"increment"in e?n=new re(t,e.increment):v();var o=x.fromServerFormat(e.fieldPath);return new se(o,n)}(t,e)})):[];if(e.update){e.update.name;var i=cn(t,e.update.name),o=new ot({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){var e=t.fieldPaths||[];return new C(e.map((function(t){return x.fromServerFormat(t)})))}(e.updateMask);return new me(i,o,s,n,r)}return new ve(i,o,n,r)}if(e.delete){var u=cn(t,e.delete);return new Ee(u,n)}if(e.verify){var a=cn(t,e.verify);return new Te(a,n)}return v()}function gn(t,e){return{documents:[hn(t,e.path)]}}function bn(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=hn(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=hn(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(rt(t.value))return{unaryFilter:{field:Sn(t.field),op:"IS_NAN"}};if(nt(t.value))return{unaryFilter:{field:Sn(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(rt(t.value))return{unaryFilter:{field:Sn(t.field),op:"IS_NOT_NAN"}};if(nt(t.value))return{unaryFilter:{field:Sn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Sn(t.field),op:On(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return function(t){return{field:Sn(t.field),direction:Tn(t.dir)}}(t)}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||B(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=_n(e.startAt)),e.endAt&&(n.structuredQuery.endAt=_n(e.endAt)),n}function wn(t){var e=fn(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){m(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=In(n.where));var u=[];n.orderBy&&(u=n.orderBy.map((function(t){return function(t){return new Tt(Dn(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)})));var a=null;n.limit&&(a=function(t){var e;return B(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=En(n.startAt));var h=null;return n.endAt&&(h=En(n.endAt)),At(e,i,u,s,a,"F",c,h)}function In(t){return t?void 0!==t.unaryFilter?[An(t)]:void 0!==t.fieldFilter?[Nn(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((function(t){return In(t)})).reduce((function(t,e){return t.concat(e)})):v():[]}function _n(t){return{before:t.before,values:t.position}}function En(t){var e=!!t.before,n=t.values||[];return new _t(n,e)}function Tn(t){return Je[t]}function On(t){return Ze[t]}function Sn(t){return{fieldPath:t.canonicalString()}}function Dn(t){return x.fromServerFormat(t.fieldPath)}function Nn(t){return dt.create(Dn(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return v()}}(t.fieldFilter.op),t.fieldFilter.value)}function An(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Dn(t.unaryFilter.field);return dt.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Dn(t.unaryFilter.field);return dt.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Dn(t.unaryFilter.field);return dt.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Dn(t.unaryFilter.field);return dt.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return v()}}function kn(t){var e=[];return t.fields.forEach((function(t){return e.push(t.canonicalString())})),{fieldPaths:e}}function jn(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function xn(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Rn(e)),e=Cn(t.get(n),e);return Rn(e)}function Cn(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function Rn(t){return t+"\x01\x01"}function Ln(t){var e=t.length;if(m(e>=2),2===e)return m("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),k.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&v(),t.charAt(s+1)){case"\x01":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:v()}o=s+2}return new k(r)}var Pn=function(t,e){this.seconds=t,this.nanoseconds=e},Mn=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Mn.store="owner",Mn.key="owner";var Fn=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Fn.store="mutationQueues",Fn.keyPath="userId";var qn=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};qn.store="mutations",qn.keyPath="batchId",qn.userMutationsIndex="userMutationsIndex",qn.userMutationsKeyPath=["userId","batchId"];var Vn=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,xn(e)]},t.key=function(t,e,n){return[t,xn(e),n]},t}();Vn.store="documentMutations",Vn.PLACEHOLDER=new Vn;var Un=function(t,e){this.path=t,this.readTime=e},Bn=function(t,e){this.path=t,this.version=e},Kn=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Kn.store="remoteDocuments",Kn.readTimeIndex="readTimeIndex",Kn.readTimeIndexPath="readTime",Kn.collectionReadTimeIndex="collectionReadTimeIndex",Kn.collectionReadTimeIndexPath=["parentPath","readTime"];var Gn=function(t){this.byteSize=t};Gn.store="remoteDocumentGlobal",Gn.key="remoteDocumentGlobalKey";var Qn=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Qn.store="targets",Qn.keyPath="targetId",Qn.queryTargetsIndexName="queryTargetsIndex",Qn.queryTargetsKeyPath=["canonicalId","targetId"];var zn=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};zn.store="targetDocuments",zn.keyPath=["targetId","path"],zn.documentTargetsIndex="documentTargetsIndex",zn.documentTargetsKeyPath=["path","targetId"];var Wn=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Wn.key="targetGlobalKey",Wn.store="targetGlobal";var Hn=function(t,e){this.collectionId=t,this.parent=e};Hn.store="collectionParents",Hn.keyPath=["collectionId","parent"];var Yn=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Yn.store="clientMetadata",Yn.keyPath="clientId";var Xn=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};Xn.store="bundles",Xn.keyPath="bundleId";var $n=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};$n.store="namedQueries",$n.keyPath="name";var Jn=Object(s.f)(Object(s.f)([],Object(s.f)(Object(s.f)([],Object(s.f)(Object(s.f)([],Object(s.f)(Object(s.f)([],[Fn.store,qn.store,Vn.store,Kn.store,Qn.store,Mn.store,Wn.store,zn.store]),[Yn.store])),[Gn.store])),[Hn.store])),[Xn.store,$n.store]),Zn="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",tr=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},t}(),er=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},nr=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&v(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}}))},t.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.waitFor=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},t}(),rr=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new er,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new sr(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=fr(e.target.error);n.ft.reject(new sr(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new sr(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(l("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new ar(e)},t}(),ir=function(){function e(t,n,i){this.name=t,this.version=n,this.wt=i,12.2===e._t(Object(r.q)())&&d("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return e.delete=function(t){return l("SimpleDb","Removing database:",t),cr(window.indexedDB.deleteDatabase(t)).toPromise()},e.yt=function(){if("undefined"==typeof indexedDB)return!1;if(e.gt())return!0;var t=Object(r.q)(),n=e._t(t),i=0<n&&n<10,o=e.Et(t),s=0<o&&o<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||i||s)},e.gt=function(){var e;return"undefined"!=typeof t&&"YES"===(null===(e=t.env)||void 0===e?void 0:e.Tt)},e.It=function(t,e){return t.store(e)},e._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},e.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},e.prototype.At=function(t){return Object(s.b)(this,void 0,void 0,(function(){var e,n=this;return Object(s.d)(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(l("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new sr(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new c(a.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new sr(t,n))},i.onupgradeneeded=function(t){l("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;n.wt.Rt(e,i.transaction,t.oldVersion,n.version).next((function(){l("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}}))}))},e.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},e.prototype.runTransaction=function(t,e,n,r){return Object(s.b)(this,void 0,void 0,(function(){var i,o,u,a,c;return Object(s.d)(this,(function(h){switch(h.label){case 0:i="readonly"===e,o=0,u=function(){var e,u,c,h,f;return Object(s.d)(this,(function(s){switch(s.label){case 0:++o,s.label=1;case 1:return s.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=s.sent(),e=rr.open(a.db,t,i?"readonly":"readwrite",n),u=r(e).catch((function(t){return e.abort(t),nr.reject(t)})).toPromise(),c={},u.catch((function(){})),[4,e.dt];case 3:return[2,(c.value=(s.sent(),u),c)];case 4:return h=s.sent(),f="FirebaseError"!==h.name&&o<3,l("SimpleDb","Transaction failed with error:",h.message,"Retrying:",f),a.close(),f?[3,5]:[2,{value:Promise.reject(h)}];case 5:return[2]}}))},a=this,h.label=1;case 1:return[5,u()];case 2:if("object"==typeof(c=h.sent()))return[2,c.value];h.label=3;case 3:return[3,1];case 4:return[2]}}))}))},e.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},e}(),or=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return cr(this.Pt.delete())},t}(),sr=function(t){function e(e,n){var r=this;return(r=t.call(this,a.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(s.c)(e,t),e}(c);function ur(t){return"IndexedDbTransactionError"===t.name}var ar=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(l("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(l("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),cr(n)},t.prototype.add=function(t){return l("SimpleDb","ADD",this.store.name,t,t),cr(this.store.add(t))},t.prototype.get=function(t){var e=this;return cr(this.store.get(t)).next((function(n){return void 0===n&&(n=null),l("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return l("SimpleDb","DELETE",this.store.name,t),cr(this.store.delete(t))},t.prototype.count=function(){return l("SimpleDb","COUNT",this.store.name),cr(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.Ft=function(t,e){l("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,(function(t,e,n){return n.delete()}))},t.prototype.Ot=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.$t=function(t){var e=this.cursor({});return new nr((function(n,r){e.onerror=function(t){var e=fr(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.xt=function(t,e){var n=[];return new nr((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new or(i),s=e(i.primaryKey,i.value,o);if(s instanceof nr){var u=s.catch((function(t){return o.done(),nr.reject(t)}));n.push(u)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}})).next((function(){return nr.waitFor(n)}))},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function cr(t){return new nr((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=fr(t.target.error);n(e)}}))}var hr=!1;function fr(t){var e=ir._t(Object(r.q)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var i=new c("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return hr||(hr=!0,setTimeout((function(){throw i}),0)),i}}return t}var lr=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return Object(s.c)(e,t),e}(tr);function dr(t,e){var n=g(t);return ir.It(n.Mt,e)}var pr=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&fe(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&le(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&le(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach((function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(O.min())}))},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),Ve())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&_(this.mutations,t.mutations,(function(t,e){return pe(t,e)}))&&_(this.baseMutations,t.baseMutations,(function(t,e){return pe(t,e)}))},t}(),yr=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){m(e.mutations.length===r.length);for(var i=Fe(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),vr=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=O.min()),void 0===o&&(o=O.min()),void 0===s&&(s=R.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),mr=function(t){this.Lt=t};function gr(t,e){if(e.document)return yn(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Q.fromSegments(e.noDocument.path),r=Er(e.noDocument.readTime),i=ut.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=Q.fromSegments(e.unknownDocument.path);return r=Er(e.unknownDocument.version),ut.newUnknownDocument(o,r)}return v()}function br(t,e,n){var r=wr(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:an(t,e.key),fields:e.data.toProto().mapValue.fields,updateTime:en(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new Kn(null,null,o,s,r,i)}if(e.isNoDocument()){var u=e.key.path.toArray(),a=_r(e.version);return s=e.hasCommittedMutations,new Kn(null,new Un(u,a),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=_r(e.version);return new Kn(new Bn(c,h),null,null,!0,r,i)}return v()}function wr(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Ir(t){var e=new T(t[0],t[1]);return O.fromTimestamp(e)}function _r(t){var e=t.toTimestamp();return new Pn(e.seconds,e.nanoseconds)}function Er(t){var e=new T(t.seconds,t.nanoseconds);return O.fromTimestamp(e)}function Tr(t,e){for(var n=(e.baseMutations||[]).map((function(e){return mn(t.Lt,e)})),r=0;r<e.mutations.length-1;++r){var i=e.mutations[r];if(r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform){var o=e.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}var s=e.mutations.map((function(e){return mn(t.Lt,e)})),u=T.fromMillis(e.localWriteTimeMs);return new pr(e.batchId,u,n,s)}function Or(t){var e,n,r=Er(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Er(t.lastLimboFreeSnapshotVersion):O.min();return void 0!==t.query.documents?(m(1===(n=t.query).documents.length),e=Mt(kt(fn(n.documents[0])))):e=function(t){return Mt(wn(t))}(t.query),new vr(e,t.targetId,0,t.lastListenSequenceNumber,r,i,R.fromBase64String(t.resumeToken))}function Sr(t,e){var n,r=_r(e.snapshotVersion),i=_r(e.lastLimboFreeSnapshotVersion);n=lt(e.target)?gn(t.Lt,e.target):bn(t.Lt,e.target);var o=e.resumeToken.toBase64();return new Qn(e.targetId,ht(e.target),r,o,e.sequenceNumber,i,n)}function Dr(t){var e=wn({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Ft(e,e.limit,"L"):e}var Nr=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return Ar(t).get(e).next((function(t){if(t)return{id:(e=t).bundleId,createTime:Er(e.createTime),version:e.version};var e}))},t.prototype.saveBundleMetadata=function(t,e){return Ar(t).put({bundleId:(n=e).id,createTime:_r(on(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return kr(t).get(e).next((function(t){if(t)return{name:(e=t).name,query:Dr(e.bundledQuery),readTime:Er(e.readTime)};var e}))},t.prototype.saveNamedQuery=function(t,e){return kr(t).put(function(t){return{name:t.name,readTime:_r(on(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function Ar(t){return dr(t,Xn.store)}function kr(t){return dr(t,$n.store)}var jr=function(){function t(){this.Bt=new xr}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),nr.resolve()},t.prototype.getCollectionParents=function(t,e){return nr.resolve(this.Bt.getEntries(e))},t}(),xr=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new je(k.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new je(k.comparator)).toArray()},t}(),Cr=function(){function t(){this.qt=new xr}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((function(){n.qt.add(e)}));var o={collectionId:r,parent:xn(i)};return Rr(t).put(o)}return nr.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[E(e),""],!1,!0);return Rr(t).Nt(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Ln(o.parent))}return n}))},t}();function Rr(t){return dr(t,Hn.store)}var Lr={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Pr=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function Mr(t,e,n){var r=t.store(qn.store),i=t.store(Vn.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.Ot({range:s},(function(t,e,n){return u++,n.delete()}));o.push(a.next((function(){m(1===u)})));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],d=Vn.key(e,l.key.path,n.batchId);o.push(i.delete(d)),c.push(l.key)}return nr.waitFor(o).next((function(){return c}))}function Fr(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw v();e=t.noDocument}return JSON.stringify(e).length}Pr.DEFAULT_COLLECTION_PERCENTILE=10,Pr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Pr.DEFAULT=new Pr(41943040,Pr.DEFAULT_COLLECTION_PERCENTILE,Pr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Pr.DISABLED=new Pr(-1,0,0);var qr=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Qt={}}return t.Kt=function(e,n,r,i){return m(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ur(t).Ot({index:qn.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=Br(t),s=Ur(t);return s.add({}).next((function(u){m("number"==typeof u);for(var a=new pr(u,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return vn(t.Lt,e)})),i=n.mutations.map((function(e){return vn(t.Lt,e)}));return new qn(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,a),h=[],f=new je((function(t,e){return I(t.canonicalString(),e.canonicalString())})),l=0,d=r;l<d.length;l++){var p=d[l],y=Vn.key(i.userId,p.key.path,u);f=f.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,Vn.PLACEHOLDER))}return f.forEach((function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.Qt[u]=a.keys()})),nr.waitFor(h).next((function(){return a}))}))},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Ur(t).get(e).next((function(t){return t?(m(t.userId===n.userId),Tr(n.R,t)):null}))},t.prototype.jt=function(t,e){var n=this;return this.Qt[e]?nr.resolve(this.Qt[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){var r=t.keys();return n.Qt[e]=r,r}return null}))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Ur(t).Ot({index:qn.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(m(e.batchId>=r),o=Tr(n.R,e)),i.done()})).next((function(){return o}))},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Ur(t).Ot({index:qn.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ur(t).Nt(qn.userMutationsIndex,n).next((function(t){return t.map((function(t){return Tr(e.R,t)}))}))},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Vn.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Br(t).Ot({range:i},(function(r,i,s){var u=r[0],a=r[1],c=r[2],h=Ln(a);if(u===n.userId&&e.path.isEqual(h))return Ur(t).get(c).next((function(t){if(!t)throw v();m(t.userId===n.userId),o.push(Tr(n.R,t))}));s.done()})).next((function(){return o}))},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new je(I),i=[];return e.forEach((function(e){var o=Vn.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),u=Br(t).Ot({range:s},(function(t,i,o){var s=t[0],u=t[1],a=t[2],c=Ln(u);s===n.userId&&e.path.isEqual(c)?r=r.add(a):o.done()}));i.push(u)})),nr.waitFor(i).next((function(){return n.Wt(t,r)}))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=Vn.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),u=new je(I);return Br(t).Ot({range:s},(function(t,e,o){var s=t[0],a=t[1],c=t[2],h=Ln(a);s===n.userId&&r.isPrefixOf(h)?h.length===i&&(u=u.add(c)):o.done()})).next((function(){return n.Wt(t,u)}))},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(Ur(t).get(e).next((function(t){if(null===t)throw v();m(t.userId===n.userId),r.push(Tr(n.R,t))})))})),nr.waitFor(i).next((function(){return r}))},t.prototype.removeMutationBatch=function(t,e){var n=this;return Mr(t.Mt,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.Gt(e.batchId)})),nr.forEach(r,(function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)}))}))},t.prototype.Gt=function(t){delete this.Qt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return nr.resolve();var r=IDBKeyRange.lowerBound(Vn.prefixForUser(e.userId)),i=[];return Br(t).Ot({range:r},(function(t,n,r){if(t[0]===e.userId){var o=Ln(t[1]);i.push(o)}else r.done()})).next((function(){m(0===i.length)}))}))},t.prototype.containsKey=function(t,e){return Vr(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return Kr(t).get(this.userId).next((function(t){return t||new Fn(e.userId,-1,"")}))},t}();function Vr(t,e,n){var r=Vn.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Br(t).Ot({range:o,kt:!0},(function(t,n,r){var o=t[0],u=t[1];t[2],o===e&&u===i&&(s=!0),r.done()})).next((function(){return s}))}function Ur(t){return dr(t,qn.store)}function Br(t){return dr(t,Vn.store)}function Kr(t){return dr(t,Fn.store)}var Gr=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),Qr=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next((function(n){var r=new Gr(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next((function(t){return O.fromTimestamp(new T(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)}))},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next((function(){return n.Xt(t).next((function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)}))}))},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return zr(t).delete(e.targetId)})).next((function(){return n.Xt(t)})).next((function(e){return m(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)}))},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return zr(t).Ot((function(s,u){var a=Or(u);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(i++,o.push(r.removeTargetData(t,a)))})).next((function(){return nr.waitFor(o)})).next((function(){return i}))},t.prototype.forEachTarget=function(t,e){return zr(t).Ot((function(t,n){var r=Or(n);e(r)}))},t.prototype.Xt=function(t){return Wr(t).get(Wn.key).next((function(t){return m(null!==t),t}))},t.prototype.Zt=function(t,e){return Wr(t).put(Wn.key,e)},t.prototype.te=function(t,e){return zr(t).put(Sr(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next((function(t){return t.targetCount}))},t.prototype.getTargetData=function(t,e){var n=ht(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return zr(t).Ot({range:r,index:Qn.queryTargetsIndexName},(function(t,n,r){var o=Or(n);ft(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Hr(t);return e.forEach((function(e){var s=xn(e.path);i.push(o.put(new zn(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))})),nr.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Hr(t);return nr.forEach(e,(function(e){var o=xn(e.path);return nr.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])}))},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Hr(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Hr(t),i=Ve();return r.Ot({range:n,kt:!0},(function(t,e,n){var r=Ln(t[1]),o=new Q(r);i=i.add(o)})).next((function(){return i}))},t.prototype.containsKey=function(t,e){var n=xn(e.path),r=IDBKeyRange.bound([n],[E(n)],!1,!0),i=0;return Hr(t).Ot({index:zn.documentTargetsIndex,kt:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.lt=function(t,e){return zr(t).get(e).next((function(t){return t?Or(t):null}))},t}();function zr(t){return dr(t,Qn.store)}function Wr(t){return dr(t,Wn.store)}function Hr(t){return dr(t,zn.store)}function Yr(t){return Object(s.b)(this,void 0,void 0,(function(){return Object(s.d)(this,(function(e){if(t.code!==a.FAILED_PRECONDITION||t.message!==Zn)throw t;return l("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}function Xr(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=I(n,i);return 0===s?I(r,o):s}var $r=function(){function t(t){this.ne=t,this.buffer=new je(Xr),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Xr(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Jr=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;l("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(function(){return Object(s.b)(e,void 0,void 0,(function(){var e;return Object(s.d)(this,(function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return ur(e=n.sent())?(l("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Yr(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),Zr=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return nr.resolve(u.o);var r=new $r(e);return this.ae.forEachTarget(t,(function(t){return r.re(t.sequenceNumber)})).next((function(){return n.ae.le(t,(function(t){return r.re(t)}))})).next((function(){return r.maxValue}))},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(l("LruGarbageCollector","Garbage collection skipped; disabled"),nr.resolve(Lr)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(l("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Lr):n.fe(t,e)}))},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,o,s,u,a,c,h=this,d=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return e>h.params.maximumSequenceNumbersToCollect?(l("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+e),r=h.params.maximumSequenceNumbersToCollect):r=e,s=Date.now(),h.nthSequenceNumber(t,r)})).next((function(r){return n=r,u=Date.now(),h.removeTargets(t,n,e)})).next((function(e){return o=e,a=Date.now(),h.removeOrphanedDocuments(t,n)})).next((function(t){return c=Date.now(),f()<=i.a.DEBUG&&l("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-d)+"ms\n\tDetermined least recently used "+r+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-d)+"ms"),nr.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:o,documentsRemoved:t})}))},t}(),ti=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new Zr(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.de=function(t){var e=0;return this.le(t,(function(t){e++})).next((function(){return e}))},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,(function(t,n){return e(n)}))},t.prototype.addReference=function(t,e,n){return ei(t,n)},t.prototype.removeReference=function(t,e,n){return ei(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return ei(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return Kr(t).$t((function(r){return Vr(t,r,e).next((function(t){return t&&(n=!0),nr.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,(function(s,u){if(u<=e){var a=n._e(t,s).next((function(e){if(!e)return o++,r.getEntry(t,s).next((function(){return r.removeEntry(s),Hr(t).delete([0,xn(s.path)])}))}));i.push(a)}})).next((function(){return nr.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return ei(t,e)},t.prototype.we=function(t,e){var n,r=Hr(t),i=u.o;return r.Ot({index:zn.documentTargetsIndex},(function(t,r){var o=t[0],s=(t[1],r.path),a=r.sequenceNumber;0===o?(i!==u.o&&e(new Q(Ln(n)),i),i=a,n=s):i=u.o})).next((function(){i!==u.o&&e(new Q(Ln(n)),i)}))},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function ei(t,e){return Hr(t).put(function(t,e){return new zn(0,xn(t.path),e)}(e,t.currentSequenceNumber))}var ni=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(this.equalsFn(s,t))return u}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){D(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];t(s,u)}}))},t.prototype.isEmpty=function(){return N(this.inner)},t}(),ri=function(){function t(){this.changes=new ni((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:O.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:ut.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?nr.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),ii=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return ui(t).put(ai(e),n)},t.prototype.removeEntry=function(t,e){var n=ui(t),r=ai(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.me(t,r)}))},t.prototype.getEntry=function(t,e){var n=this;return ui(t).get(ai(e)).next((function(t){return n.ye(e,t)}))},t.prototype.ge=function(t,e){var n=this;return ui(t).get(ai(e)).next((function(t){return{document:n.ye(e,t),size:Fr(t)}}))},t.prototype.getEntries=function(t,e){var n=this,r=Re();return this.pe(t,e,(function(t,e){var i=n.ye(t,e);r=r.insert(t,i)})).next((function(){return r}))},t.prototype.Ee=function(t,e){var n=this,r=Re(),i=new Ne(Q.comparator);return this.pe(t,e,(function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,Fr(e))})).next((function(){return{documents:r,Te:i}}))},t.prototype.pe=function(t,e,n){if(e.isEmpty())return nr.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return ui(t).Ot({range:r},(function(t,e,r){for(var s=Q.fromSegments(t);o&&Q.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=Re(),o=e.path.length+1,s={};if(n.isEqual(O.min())){var u=e.path.toArray();s.range=IDBKeyRange.lowerBound(u)}else{var a=e.path.toArray(),c=wr(n);s.range=IDBKeyRange.lowerBound([a,c],!0),s.index=Kn.collectionReadTimeIndex}return ui(t).Ot(s,(function(t,n,s){if(t.length===o){var u=gr(r.R,n);e.path.isPrefixOf(u.key.path)?Bt(e,u)&&(i=i.insert(u.key,u)):s.done()}})).next((function(){return i}))},t.prototype.newChangeBuffer=function(t){return new oi(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return si(t).get(Gn.key).next((function(t){return m(!!t),t}))},t.prototype.me=function(t,e){return si(t).put(Gn.key,e)},t.prototype.ye=function(t,e){if(e){var n=gr(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(O.min()))return n}return ut.newInvalidDocument(t)},t}(),oi=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new ni((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return Object(s.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new je((function(t,e){return I(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,s){var u=e.Ae.get(o);if(s.document.isValidDocument()){var a=br(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=Fr(a);r+=c-u,n.push(e.Ie.addEntry(t,o,a))}else if(r-=u,e.trackRemovals){var h=br(e.Ie.R,ut.newNoDocument(o,O.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))})),i.forEach((function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))})),n.push(this.Ie.updateMetadata(t,r)),nr.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next((function(t){return n.Ae.set(e,t.size),t.document}))},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next((function(t){var e=t.documents;return t.Te.forEach((function(t,e){n.Ae.set(t,e)})),e}))},e}(ri);function si(t){return dr(t,Gn.store)}function ui(t){return dr(t,Kn.store)}function ai(t){return t.path.toArray()}var ci=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;m(n<r&&n>=0&&r<=11);var o=new rr("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(Mn.store)}(t),function(t){t.createObjectStore(Fn.store,{keyPath:Fn.keyPath}),t.createObjectStore(qn.store,{keyPath:qn.keyPath,autoIncrement:!0}).createIndex(qn.userMutationsIndex,qn.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Vn.store)}(t),hi(t),function(t){t.createObjectStore(Kn.store)}(t));var s=nr.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(zn.store),t.deleteObjectStore(Qn.store),t.deleteObjectStore(Wn.store)}(t),hi(t)),s=s.next((function(){return function(t){var e=t.store(Wn.store),n=new Wn(0,0,O.min().toTimestamp(),0);return e.put(Wn.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(qn.store).Nt().next((function(n){t.deleteObjectStore(qn.store),t.createObjectStore(qn.store,{keyPath:qn.keyPath,autoIncrement:!0}).createIndex(qn.userMutationsIndex,qn.userMutationsKeyPath,{unique:!0});var r=e.store(qn.store),i=n.map((function(t){return r.put(t)}));return nr.waitFor(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(Yn.store,{keyPath:Yn.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.Re(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(Gn.store)}(t),i.be(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ve(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.Pe(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Kn.store);e.createIndex(Kn.readTimeIndex,Kn.readTimeIndexPath,{unique:!1}),e.createIndex(Kn.collectionReadTimeIndex,Kn.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.Ve(o)}))),n<11&&r>=11&&(s=s.next((function(){!function(t){t.createObjectStore(Xn.store,{keyPath:Xn.keyPath})}(t),function(t){t.createObjectStore($n.store,{keyPath:$n.keyPath})}(t)}))),s},t.prototype.be=function(t){var e=0;return t.store(Kn.store).Ot((function(t,n){e+=Fr(n)})).next((function(){var n=new Gn(e);return t.store(Gn.store).put(Gn.key,n)}))},t.prototype.Re=function(t){var e=this,n=t.store(Fn.store),r=t.store(qn.store);return n.Nt().next((function(n){return nr.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(qn.userMutationsIndex,i).next((function(r){return nr.forEach(r,(function(r){m(r.userId===n.userId);var i=Tr(e.R,r);return Mr(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ve=function(t){var e=t.store(zn.store),n=t.store(Kn.store);return t.store(Wn.store).get(Wn.key).next((function(t){var r=[];return n.Ot((function(n,i){var o=new k(n),s=function(t){return[0,xn(t)]}(o);r.push(e.get(s).next((function(n){return n?nr.resolve():function(n){return e.put(new zn(0,xn(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return nr.waitFor(r)}))}))},t.prototype.Pe=function(t,e){t.createObjectStore(Hn.store,{keyPath:Hn.keyPath});var n=e.store(Hn.store),r=new xr,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:xn(i)})}};return e.store(Kn.store).Ot({kt:!0},(function(t,e){var n=new k(t);return i(n.popLast())})).next((function(){return e.store(Vn.store).Ot({kt:!0},(function(t,e){t[0];var n=t[1],r=(t[2],Ln(n));return i(r.popLast())}))}))},t.prototype.Ve=function(t){var e=this,n=t.store(Qn.store);return n.Ot((function(t,r){var i=Or(r),o=Sr(e.R,i);return n.put(o)}))},t}();function hi(t){t.createObjectStore(zn.store,{keyPath:zn.keyPath}).createIndex(zn.documentTargetsIndex,zn.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Qn.store,{keyPath:Qn.keyPath}).createIndex(Qn.queryTargetsIndexName,Qn.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Wn.store)}var fi="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",li=function(){function t(e,n,r,i,o,s,u,h,f,l){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=u,this.De=f,this.Ce=l,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.Oe=null,this.$e=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new c(a.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new ti(this,i),this.Le=n+"main",this.R=new mr(h),this.Be=new ir(this.Le,11,new ci(this.R)),this.qe=new Qr(this.referenceDelegate,this.R),this.Ut=new Cr,this.Ue=function(t,e){return new ii(t,e)}(this.R,this.Ut),this.Qe=new Nr,this.window&&this.window.localStorage?this.Ke=this.window.localStorage:(this.Ke=null,!1===l&&d("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new c(a.FAILED_PRECONDITION,fi);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.qe.getHighestSequenceNumber(e)}))})).then((function(e){t.Ne=new u(e,t.De)})).then((function(){t.xe=!0})).catch((function(e){return t.Be&&t.Be.close(),Promise.reject(e)}))},t.prototype.He=function(t){var e=this;return this.Me=function(n){return Object(s.b)(e,void 0,void 0,(function(){return Object(s.d)(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt((function(n){return Object(s.b)(e,void 0,void 0,(function(){return Object(s.d)(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget((function(){return Object(s.b)(e,void 0,void 0,(function(){return Object(s.d)(this,(function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return pi(e).put(new Yn(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.Je(e).next((function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable((function(){return t.Me(!1)})))}))})).next((function(){return t.Ye(e)})).next((function(n){return t.isPrimary&&!n?t.Xe(e).next((function(){return!1})):!!n&&t.Ze(e).next((function(){return!0}))}))})).catch((function(e){if(ur(e))return l("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return l("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Se.enqueueRetryable((function(){return t.Me(e)})),t.isPrimary=e}))},t.prototype.Je=function(t){var e=this;return di(t).get(Mn.key).next((function(t){return nr.resolve(e.tn(t))}))},t.prototype.en=function(t){return pi(t).delete(this.clientId)},t.prototype.nn=function(){return Object(s.b)(this,void 0,void 0,(function(){var t,e,n,r,i=this;return Object(s.d)(this,(function(o){switch(o.label){case 0:return!this.isPrimary||this.sn(this.$e,18e5)?[3,2]:(this.$e=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=dr(t,Yn.store);return e.Nt().next((function(t){var n=i.rn(t,18e5),r=t.filter((function(t){return-1===n.indexOf(t)}));return nr.forEach(r,(function(t){return e.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(t=o.sent(),this.Ke)for(e=0,n=t;e<n.length;e++)r=n[e],this.Ke.removeItem(this.on(r.clientId));o.label=2;case 2:return[2]}}))}))},t.prototype.ze=function(){var t=this;this.Oe=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return t.je().then((function(){return t.nn()})).then((function(){return t.ze()}))}))},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?nr.resolve(!0):di(t).get(Mn.key).next((function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new c(a.FAILED_PRECONDITION,fi);return!1}}return!(!e.networkEnabled||!e.inForeground)||pi(t).Nt().next((function(t){return void 0===e.rn(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&l("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.shutdown=function(){return Object(s.b)(this,void 0,void 0,(function(){var t=this;return Object(s.d)(this,(function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.Oe&&(this.Oe.cancel(),this.Oe=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Mn.store,Yn.store],(function(e){var n=new lr(e,u.o);return t.Xe(n).next((function(){return t.en(n)}))}))];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}}))}))},t.prototype.rn=function(t,e){var n=this;return t.filter((function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)}))},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return pi(e).Nt().next((function(e){return t.rn(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return qr.Kt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;l("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.Be.runTransaction(t,o,Jn,(function(o){return i=new lr(o,r.Ne?r.Ne.next():u.o),"readwrite-primary"===e?r.Je(i).next((function(t){return!!t||r.Ye(i)})).next((function(e){if(!e)throw d("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.Se.enqueueRetryable((function(){return r.Me(!1)})),new c(a.FAILED_PRECONDITION,Zn);return n(i)})).next((function(t){return r.Ze(i).next((function(){return t}))})):r.dn(i).next((function(){return n(i)}))})).then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.dn=function(t){var e=this;return di(t).get(Mn.key).next((function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new c(a.FAILED_PRECONDITION,fi)}))},t.prototype.Ze=function(t){var e=new Mn(this.clientId,this.allowTabSynchronization,Date.now());return di(t).put(Mn.key,e)},t.yt=function(){return ir.yt()},t.prototype.Xe=function(t){var e=this,n=di(t);return n.get(Mn.key).next((function(t){return e.tn(t)?(l("IndexedDbPersistence","Releasing primary lease."),n.delete(Mn.key)):nr.resolve()}))},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(d("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.je()}))},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),e.Se.enqueueAndForget((function(){return e.shutdown()}))},this.window.addEventListener("unload",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("unload",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Ke)||void 0===e?void 0:e.getItem(this.on(t)));return l("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return d("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Ke)try{this.Ke.setItem(this.on(this.clientId),String(Date.now()))}catch(t){d("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Ke)try{this.Ke.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function di(t){return dr(t,Mn.store)}function pi(t){return dr(t,Yn.store)}function yi(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var vi=function(t,e){this.progress=t,this.wn=e},mi=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.yn(t,e,r)}))},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next((function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t}))},t.prototype.gn=function(t,e){t.forEach((function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)}))},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next((function(e){return n.En(t,e).next((function(){return e}))}))},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(t){return n.gn(e,t)}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return Q.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):Lt(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new Q(e)).next((function(t){var e=Pe();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=Pe();return this.Ut.getCollectionParents(t,i).next((function(s){return nr.forEach(s,(function(s){var u=function(t,e){return new Nt(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,u,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return i=e,o.Rn(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,u=o.mutations;s<u.length;s++){var a=u[s],c=a.key,h=r.get(c);null==h&&(h=ut.newInvalidDocument(c),r=r.insert(c,h)),le(a,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}}))})).next((function(){return r.forEach((function(t,n){Bt(e,n)||(r=r.remove(t))})),r}))},t.prototype.Rn=function(t,e,n){for(var r=Ve(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof me&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.Ue.getEntries(t,r).next((function(t){return t.forEach((function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))})),c}))},t}(),gi=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=Ve(),i=Ve(),o=0,s=n.docChanges;o<s.length;o++){var u=s[o];switch(u.type){case 0:r=r.add(u.doc.key);break;case 1:i=i.add(u.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),bi=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var o=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(O.min())?this.Dn(t,e):this.Sn.pn(t,r).next((function(s){var u=o.Cn(e,s);return(jt(e)||xt(e))&&o.Nn(e.limitType,u,r,n)?o.Dn(t,e):(f()<=i.a.DEBUG&&l("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Ut(e)),o.Sn.getDocumentsMatchingQuery(t,e,n).next((function(t){return u.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},t.prototype.Cn=function(t,e){var n=new je(Kt(t));return e.forEach((function(e,r){Bt(t,r)&&(n=n.add(r))})),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return f()<=i.a.DEBUG&&l("QueryEngine","Using full collection scan to execute query:",Ut(e)),this.Sn.getDocumentsMatchingQuery(t,e,O.min())},t}(),wi=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new Ne(I),this.kn=new ni((function(t){return ht(t)}),ft),this.On=O.min(),this._n=t.getMutationQueue(n),this.$n=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new mi(this.$n,this._n,this.persistence.getIndexManager()),this.Qe=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.collect(n,e.Fn)}))},t}();function Ii(t,e,n,r){return new wi(t,e,n,r)}function _i(t,e){return Object(s.b)(this,void 0,void 0,(function(){var n,r,i,o;return Object(s.d)(this,(function(s){switch(s.label){case 0:return n=g(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var o;return n._n.getAllMutationBatches(t).next((function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new mi(n.$n,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)})).next((function(e){for(var n=[],r=[],s=Ve(),u=0,a=o;u<a.length;u++){var c=a[u];n.push(c.batchId);for(var h=0,f=c.mutations;h<f.length;h++){var l=f[h];s=s.add(l.key)}}for(var d=0,p=e;d<p.length;d++){var y=p[d];r.push(y.batchId);for(var v=0,m=y.mutations;v<m.length;v++){var g=m[v];s=s.add(g.key)}}return i.pn(t,s).next((function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}}))}))}))];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}}))}))}function Ei(t,e){var n=g(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r=e.batch.keys(),i=n.$n.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=nr.resolve();return o.forEach((function(t){s=s.next((function(){return r.getEntry(e,t)})).next((function(e){var o=n.docVersions.get(t);m(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))}))})),s.next((function(){return t._n.removeMutationBatch(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}function Ti(t){var e=g(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.qe.getLastRemoteSnapshotVersion(t)}))}function Oi(t,e){var n=g(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.$n.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach((function(e,o){var u=i.get(o);if(u){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next((function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)})));var a=e.resumeToken;if(a.approximateByteSize()>0){var c=u.withResumeToken(a,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return m(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(u,c,e)&&s.push(n.qe.updateTargetData(t,c))}}}));var u=Re();if(e.documentUpdates.forEach((function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),s.push(Si(t,o,e.documentUpdates,r,void 0).next((function(t){u=t}))),!r.isEqual(O.min())){var a=n.qe.getLastRemoteSnapshotVersion(t).next((function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)}));s.push(a)}return nr.waitFor(s).next((function(){return o.apply(t)})).next((function(){return n.Mn.En(t,u)})).next((function(){return u}))})).then((function(t){return n.Fn=i,t}))}function Si(t,e,n,r,i){var o=Ve();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var o=Re();return n.forEach((function(n,s){var u=t.get(n),a=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(O.min())?(e.removeEntry(n,a),o=o.insert(n,s)):!u.isValidDocument()||s.version.compareTo(u.version)>0||0===s.version.compareTo(u.version)&&u.hasPendingWrites?(e.addEntry(s,a),o=o.insert(n,s)):l("LocalStore","Ignoring outdated watch update for ",n,". Current version:",u.version," Watch version:",s.version)})),o}))}function Di(t,e){var n=g(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)}))}function Ni(t,e){var n=g(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.qe.getTargetData(t,e).next((function(i){return i?(r=i,nr.resolve(r)):n.qe.allocateTargetId(t).next((function(i){return r=new vr(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t}))}function Ai(t,e,n){return Object(s.b)(this,void 0,void 0,(function(){var r,i,o,u;return Object(s.d)(this,(function(s){switch(s.label){case 0:r=g(t),i=r.Fn.get(e),o=n?"readwrite":"readwrite-primary",s.label=1;case 1:return s.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,(function(t){return r.persistence.referenceDelegate.removeTarget(t,i)}))];case 2:s.sent(),s.label=3;case 3:return[3,5];case 4:if(!ur(u=s.sent()))throw u;return l("LocalStore","Failed to update sequence numbers for target "+e+": "+u),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(i.target),[2]}}))}))}function ki(t,e,n){var r=g(t),i=O.min(),o=Ve();return r.persistence.runTransaction("Execute query","readonly",(function(t){return function(t,e,n){var r=g(t),i=r.kn.get(n);return void 0!==i?nr.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,Mt(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:O.min(),n?o:Ve())})).next((function(t){return{documents:t,Bn:o}}))}))}function ji(t,e){var n=g(t),r=g(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.lt(t,e).next((function(t){return t?t.target:null}))}))}function xi(t){var e=g(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return function(t,e,n){var r=g(t),i=Re(),o=wr(n),s=ui(e),u=IDBKeyRange.lowerBound(o,!0);return s.Ot({index:Kn.readTimeIndex,range:u},(function(t,e){var n=gr(r.R,e);i=i.insert(n.key,n),o=e.readTime})).next((function(){return{wn:i,readTime:Ir(o)}}))}(e.$n,t,e.On)})).then((function(t){var n=t.wn,r=t.readTime;return e.On=r,n}))}function Ci(t){return Object(s.b)(this,void 0,void 0,(function(){var e;return Object(s.d)(this,(function(n){return[2,(e=g(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return function(t){var e=ui(t),n=O.min();return e.Ot({index:Kn.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=Ir(e.readTime)),r.done()})).next((function(){return n}))}(t)})).then((function(t){e.On=t}))]}))}))}function Ri(t,e,n,r){return Object(s.b)(this,void 0,void 0,(function(){var i,o,u,a,c,h,f,l,d,p;return Object(s.d)(this,(function(s){switch(s.label){case 0:for(i=g(t),o=Ve(),u=Re(),a=Fe(),c=0,h=n;c<h.length;c++)f=h[c],l=e.qn(f.metadata.name),f.document&&(o=o.add(l)),u=u.insert(l,e.Un(f)),a=a.insert(l,e.Qn(f.metadata.readTime));return d=i.$n.newChangeBuffer({trackRemovals:!0}),[4,Ni(i,function(t){return Mt(kt(k.fromString("__bundle__/docs/"+t)))}(r))];case 1:return p=s.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",(function(t){return Si(t,d,u,O.min(),a).next((function(e){return d.apply(t),e})).next((function(e){return i.qe.removeMatchingKeysForTargetId(t,p.targetId).next((function(){return i.qe.addMatchingKeys(t,o,p.targetId)})).next((function(){return i.Mn.En(t,e)})).next((function(){return e}))}))}))]}}))}))}function Li(t,e,n){return void 0===n&&(n=Ve()),Object(s.b)(this,void 0,void 0,(function(){var r,i;return Object(s.d)(this,(function(o){switch(o.label){case 0:return[4,Ni(t,Mt(Dr(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=g(t)).persistence.runTransaction("Save named query","readwrite",(function(t){var o=on(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Qe.saveNamedQuery(t,e);var s=r.withResumeToken(R.EMPTY_BYTE_STRING,o);return i.Fn=i.Fn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next((function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)})).next((function(){return i.qe.addMatchingKeys(t,n,r.targetId)})).next((function(){return i.Qe.saveNamedQuery(t,e)}))}))]}}))}))}var Pi=function(){function t(t){this.R=t,this.Kn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return nr.resolve(this.Kn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Kn.set(e.id,{id:(n=e).id,version:n.version,createTime:on(n.createTime)}),nr.resolve()},t.prototype.getNamedQuery=function(t,e){return nr.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:Dr(t.bundledQuery),readTime:on(t.readTime)}}(e)),nr.resolve()},t}(),Mi=function(){function t(){this.Wn=new je(Fi.Gn),this.zn=new je(Fi.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new Fi(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},t.prototype.removeReference=function(t,e){this.Yn(new Fi(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},t.prototype.Zn=function(t){var e=this,n=new Q(new k([])),r=new Fi(n,t),i=new Fi(n,t+1),o=[];return this.zn.forEachInRange([r,i],(function(t){e.Yn(t),o.push(t.key)})),o},t.prototype.ts=function(){var t=this;this.Wn.forEach((function(e){return t.Yn(e)}))},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new Q(new k([])),n=new Fi(e,t),r=new Fi(e,t+1),i=Ve();return this.zn.forEachInRange([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.containsKey=function(t){var e=new Fi(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Fi=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return Q.comparator(t.key,e.key)||I(t.ns,e.ns)},t.Hn=function(t,e){return I(t.ns,e.ns)||Q.comparator(t.key,e.key)},t}(),qi=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new je(Fi.Gn)}return t.prototype.checkEmpty=function(t){return nr.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++,this._n.length>0&&this._n[this._n.length-1];var o=new pr(i,e,n,r);this._n.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.rs=this.rs.add(new Fi(a.key,i)),this.Ut.addToCollectionParentIndex(t,a.key.path.popLast())}return nr.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return nr.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.cs(n),i=r<0?0:r;return nr.resolve(this._n.length>i?this._n[i]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return nr.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return nr.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Fi(e,0),i=new Fi(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],(function(t){var e=n.os(t.ns);o.push(e)})),nr.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new je(I);return e.forEach((function(t){var e=new Fi(t,0),i=new Fi(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],(function(t){r=r.add(t.ns)}))})),nr.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;Q.isDocumentKey(i)||(i=i.child(""));var o=new Fi(new Q(i),0),s=new je(I);return this.rs.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)}),o),nr.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.os(t);null!==r&&n.push(r)})),n},t.prototype.removeMutationBatch=function(t,e){var n=this;m(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return nr.forEach(e.mutations,(function(i){var o=new Fi(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((function(){n.rs=r}))},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new Fi(e,0),r=this.rs.firstAfterOrEqual(n);return nr.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return this._n.length,nr.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),Vi=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Ne(Q.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return nr.resolve(n?n.document.clone():ut.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=Re();return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():ut.newInvalidDocument(t))})),nr.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Re(),i=new Q(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),u=s.key,a=s.value,c=a.document,h=a.readTime;if(!e.path.isPrefixOf(u.path))break;h.compareTo(n)<=0||Bt(e,c)&&(r=r.insert(c.key,c.clone()))}return nr.resolve(r)},t.prototype.fs=function(t,e){return nr.forEach(this.docs,(function(t){return e(t)}))},t.prototype.newChangeBuffer=function(t){return new Ui(this)},t.prototype.getSize=function(t){return nr.resolve(this.size)},t}(),Ui=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return Object(s.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)})),nr.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(ri),Bi=function(){function t(t){this.persistence=t,this.ds=new ni((function(t){return ht(t)}),ft),this.lastRemoteSnapshotVersion=O.min(),this.highestTargetId=0,this.ws=0,this._s=new Mi,this.targetCount=0,this.ys=Gr.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach((function(t,n){return e(n)})),nr.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return nr.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return nr.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),nr.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),nr.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new Gr(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,nr.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),nr.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,nr.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach((function(s,u){u.sequenceNumber<=e&&null===n.get(u.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,u.targetId)),i++)})),nr.waitFor(o).next((function(){return i}))},t.prototype.getTargetCount=function(t){return nr.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return nr.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),nr.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.markPotentiallyOrphaned(t,e))})),nr.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),nr.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return nr.resolve(n)},t.prototype.containsKey=function(t,e){return nr.resolve(this._s.containsKey(e))},t}(),Ki=function(){function t(t,e){var n=this;this.gs={},this.Ne=new u(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Bi(this),this.Ut=new jr,this.Ue=function(t,e){return new Vi(t,(function(t){return n.referenceDelegate.ps(t)}))}(this.Ut),this.R=new mr(e),this.Qe=new Pi(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new qi(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;l("MemoryPersistence","Starting transaction:",t);var i=new Gi(this.Ne.next());return this.referenceDelegate.Es(),n(i).next((function(t){return r.referenceDelegate.Ts(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.Is=function(t,e){return nr.or(Object.values(this.gs).map((function(n){return function(){return n.containsKey(t,e)}})))},t}(),Gi=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return Object(s.c)(e,t),e}(tr),Qi=function(){function t(t){this.persistence=t,this.As=new Mi,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw v()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),nr.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),nr.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),nr.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach((function(t){return n.vs.add(t.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.vs.add(t.toString())}))})).next((function(){return r.removeTargetData(t,e)}))},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return nr.forEach(this.vs,(function(r){var i=Q.fromPath(r);return e.Ps(t,i).next((function(t){t||n.removeEntry(i)}))})).next((function(){return e.Rs=null,n.apply(t)}))},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next((function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())}))},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return nr.or([function(){return nr.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),zi=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function Wi(t,e){return"firestore_clients_"+t+"_"+e}function Hi(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function Yi(t,e){return"firestore_targets_"+t+"_"+e}zi.UNAUTHENTICATED=new zi(null),zi.GOOGLE_CREDENTIALS=new zi("google-credentials-uid"),zi.FIRST_PARTY=new zi("first-party-uid");var Xi=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new c(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(d("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),$i=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new c(i.error.code,i.error.message)),o?new t(e,i.state,r):(d("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Ji=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Be(),s=0;i&&s<r.activeTargetIds.length;++s)i=G(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(d("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Zi=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(d("SharedClientState","Failed to parse online state: "+e),null)},t}(),to=function(){function t(){this.activeTargetIds=Be()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),eo=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new Ne(I),this.started=!1,this.Os=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.$s=Wi(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new to),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Qs=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(s.b)(this,void 0,void 0,(function(){var t,e,n,r,i,o,u,a,c,h,f,l=this;return Object(s.d)(this,(function(s){switch(s.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=s.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(Wi(this.persistenceKey,r)))&&(o=Ji.Vs(r,i))&&(this.ks=this.ks.insert(o.clientId,o));for(this.Ks(),(u=this.storage.getItem(this.Us))&&(a=this.js(u))&&this.Ws(a),c=0,h=this.Os;c<h.length;c++)f=h[c],this.Fs(f);return this.Os=[],this.window.addEventListener("unload",(function(){return l.shutdown()})),this.started=!0,[2]}}))}))},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(Yi(this.persistenceKey,t));if(n){var r=$i.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Ks(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Ks()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(Yi(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.Hs(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.$s),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return l("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){l("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){l("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(l("SharedClientState","EVENT",n.key,n.newValue),n.key===this.$s)return void d("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable((function(){return Object(s.b)(e,void 0,void 0,(function(){var t,e,r,i,o,a;return Object(s.d)(this,(function(s){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(a=function(t){var e=u.o;if(null!=t)try{var n=JSON.parse(t);m("number"==typeof n),e=n}catch(t){d("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==u.o&&this.sequenceNumberHandler(a);else if(n.key===this.Qs)return[2,this.syncEngine.ci()]}else this.Os.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Ks=function(){this.setItem(this.$s,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new Xi(this.currentUser,t,e,n),i=Hi(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=Hi(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){var e={clientId:this.Ns,onlineState:t};this.storage.setItem(this.Us,JSON.stringify(e))},t.prototype.Ys=function(t,e,n){var r=Yi(this.persistenceKey,t),i=new $i(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Qs,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return Ji.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Xi.Vs(new zi(i),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return $i.Vs(r,e)},t.prototype.js=function(t){return Zi.Vs(t)},t.prototype.ii=function(t){return Object(s.b)(this,void 0,void 0,(function(){return Object(s.d)(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(l("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],u=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||u.push(t)})),this.syncEngine.hi(s,u).then((function(){n.ks=r}))},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=Be();return t.forEach((function(t,n){e=e.unionWith(n.activeTargetIds)})),e},t}(),no=function(){function t(){this.li=new to,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new to,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),ro=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),io=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){l("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){l("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),oo={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},so=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),uo=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n}return Object(s.c)(e,t),e.prototype.ki=function(t,e,n,r){return new Promise((function(i,s){var u=new o.f;u.listenOnce(o.c.COMPLETE,(function(){try{switch(u.getLastErrorCode()){case o.a.NO_ERROR:var e=u.getResponseJson();l("Connection","XHR received:",JSON.stringify(e)),i(e);break;case o.a.TIMEOUT:l("Connection",'RPC "'+t+'" timed out'),s(new c(a.DEADLINE_EXCEEDED,"Request time out"));break;case o.a.HTTP_ERROR:var n=u.getStatus();if(l("Connection",'RPC "'+t+'" failed with status:',n,"response text:",u.getResponseText()),n>0){var r=u.getResponseJson().error;if(r&&r.status&&r.message){var h=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(a).indexOf(e)>=0?e:a.UNKNOWN}(r.status);s(new c(h,r.message))}else s(new c(a.UNKNOWN,"Server responded with status "+u.getStatus()))}else s(new c(a.UNAVAILABLE,"Connection failed."));break;default:v()}}finally{l("Connection",'RPC "'+t+'" completed.')}}));var h=JSON.stringify(r);u.send(e,"POST",h,n,15)}))},e.prototype.$i=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=Object(o.g)(),s=Object(o.h)(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.Fi(u.initMessageHeaders,e),Object(r.y)()||Object(r.B)()||Object(r.u)()||Object(r.w)()||Object(r.C)()||Object(r.t)()||(u.httpHeadersOverwriteParam="$httpHeaders");var h=n.join("");l("Connection","Creating WebChannel: "+h,u);var f=i.createWebChannel(h,u),d=!1,y=!1,v=new so({Ei:function(t){y?l("Connection","Not sending because WebChannel is closed:",t):(d||(l("Connection","Opening WebChannel transport."),f.open(),d=!0),l("Connection","WebChannel sending:",t),f.send(t))},Ti:function(){return f.close()}}),g=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return g(f,o.e.EventType.OPEN,(function(){y||l("Connection","WebChannel transport opened.")})),g(f,o.e.EventType.CLOSE,(function(){y||(y=!0,l("Connection","WebChannel transport closed"),v.Vi())})),g(f,o.e.EventType.ERROR,(function(t){y||(y=!0,p("Connection","WebChannel transport errored:",t),v.Vi(new c(a.UNAVAILABLE,"The operation could not be completed")))})),g(f,o.e.EventType.MESSAGE,(function(t){var e;if(!y){var n=t.data[0];m(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){l("Connection","WebChannel received error:",i);var o=i.status,s=function(t){var e=Ie[t];if(void 0!==e)return De(e)}(o),u=i.message;void 0===s&&(s=a.INTERNAL,u="Unknown error status: "+o+" with message "+i.message),y=!0,v.Vi(new c(s,u)),f.close()}else l("Connection","WebChannel received:",n),v.Si(n)}})),g(s,o.b.STAT_EVENT,(function(t){t.stat===o.d.PROXY?l("Connection","Detected buffering proxy"):t.stat===o.d.NOPROXY&&l("Connection","Detected no buffering proxy")})),setTimeout((function(){v.Pi()}),0),v},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);l("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then((function(t){return l("RestConnection","Received: ",t),t}),(function(e){throw p("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.Oi=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.4.0",t["X-Firebase-GMPID"]=this.databaseInfo.appId,t["Content-Type"]="text/plain",e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){var n=oo[t];return this.Di+"/v1/"+e+":"+n},t}());function ao(){return"undefined"!=typeof window?window:null}function co(){return"undefined"!=typeof document?document:null}function ho(t){return new tn(t,!0)}var fo=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Qi=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Ki=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Qi),i=Math.max(0,n-r);i>0&&l("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,(function(){return e.Qi=Date.now(),t()})),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),lo=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new fo(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return Object(s.b)(this,void 0,void 0,(function(){return Object(s.d)(this,(function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,(function(){return t.rr()})))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return Object(s.b)(this,void 0,void 0,(function(){return Object(s.d)(this,(function(t){return this.er()?[2,this.close(0)]:[2]}))}))},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return Object(s.b)(this,void 0,void 0,(function(){return Object(s.d)(this,(function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===a.RESOURCE_EXHAUSTED?(d(e.toString()),d("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Ki()):e&&e.code===a.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then((function(e){t.Yi===n&&t.lr(e)}),(function(n){e((function(){var e=new c(a.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)}))}))},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii((function(){n((function(){return e.state=2,e.listener.Ii()}))})),this.stream.Ri((function(t){n((function(){return e.dr(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji((function(){return Object(s.b)(t,void 0,void 0,(function(){return Object(s.d)(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.dr=function(t){return l("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget((function(){return e.Yi===t?n():(l("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),po=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return Object(s.c)(e,t),e.prototype.wr=function(t){return this.Hi.$i("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:v()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(m(void 0===e||"string"==typeof e),R.fromBase64String(e||"")):(m(void 0===e||e instanceof Uint8Array),R.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(u=e.targetChange.cause)&&function(t){var e=void 0===t.code?a.UNKNOWN:De(t.code);return new c(e,t.message||"")}(u);n=new We(r,i,o,s||null)}else if("documentChange"in e){e.documentChange,(r=e.documentChange).document,r.document.name,r.document.updateTime,i=cn(t,r.document.name),o=on(r.document.updateTime);var u=new ot({mapValue:{fields:r.document.fields}}),h=(s=ut.newFoundDocument(i,o,u),r.targetIds||[]),f=r.removedTargetIds||[];n=new Qe(h,f,s.key,s)}else if("documentDelete"in e)e.documentDelete,(r=e.documentDelete).document,i=cn(t,r.document),o=r.readTime?on(r.readTime):O.min(),u=ut.newNoDocument(i,o),s=r.removedTargetIds||[],n=new Qe([],s,u.key,u);else if("documentRemove"in e)e.documentRemove,(r=e.documentRemove).document,i=cn(t,r.document),o=r.removedTargetIds||[],n=new Qe([],o,i,null);else{if(!("filter"in e))return v();e.filter;var l=e.filter;l.targetId,r=l.count||0,i=new Oe(r),o=l.targetId,n=new ze(o,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return O.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?O.min():e.readTime?on(e.readTime):O.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=ln(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=lt(r)?{documents:gn(t,r)}:{query:bn(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=nn(t,e.resumeToken):e.snapshotVersion.compareTo(O.min())>0&&(n.readTime=en(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return v()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.R,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=ln(this.R),e.removeTarget=t,this.cr(e)},e}(lo),yo=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return Object(s.c)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.$i("Write",t)},e.prototype.onMessage=function(t){if(m(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(m(void 0!==e),t.map((function(t){return function(t,e){var n=t.updateTime?on(t.updateTime):on(e);return n.isEqual(O.min())&&(n=on(e)),new ue(n,t.transformResults||[])}(t,e)}))):[]}(t.writeResults,t.commitTime),n=on(t.commitTime);return this.listener.Tr(n,e)}return m(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=ln(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return vn(e.R,t)}))};this.cr(n)},e}(lo),vo=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return Object(s.c)(e,t),e.prototype.br=function(){if(this.Rr)throw new c(a.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Ni(t,e,n,i)})).catch((function(t){throw t.code===a.UNAUTHENTICATED&&r.credentials.invalidateToken(),t}))},e.prototype.Oi=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Oi(t,e,n,i)})).catch((function(t){throw t.code===a.UNAUTHENTICATED&&r.credentials.invalidateToken(),t}))},e.prototype.terminate=function(){this.Rr=!1},e}((function(){})),mo=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()})))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(d(e),this.Vr=!1):l("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),go=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.Or=new Map,this.$r=new Set,this.Mr=[],this.Lr=i,this.Lr.di((function(t){n.enqueueAndForget((function(){return Object(s.b)(o,void 0,void 0,(function(){return Object(s.d)(this,(function(t){switch(t.label){case 0:return Do(this)?(l("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(s.b)(this,void 0,void 0,(function(){var e;return Object(s.d)(this,(function(n){switch(n.label){case 0:return(e=g(t)).$r.add(4),[4,wo(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.$r.delete(4),[4,bo(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Br=new mo(n,r)};function bo(t){return Object(s.b)(this,void 0,void 0,(function(){var e,n;return Object(s.d)(this,(function(r){switch(r.label){case 0:if(!Do(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function wo(t){return Object(s.b)(this,void 0,void 0,(function(){var e,n;return Object(s.d)(this,(function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Io(t,e){var n=g(t);n.Or.has(e.targetId)||(n.Or.set(e.targetId,e),So(n)?Oo(n):Bo(n).er()&&Eo(n,e))}function _o(t,e){var n=g(t),r=Bo(n);n.Or.delete(e),r.er()&&To(n,e),0===n.Or.size&&(r.er()?r.ir():Do(n)&&n.Br.set("Unknown"))}function Eo(t,e){t.qr.U(e.targetId),Bo(t).mr(e)}function To(t,e){t.qr.U(e),Bo(t).yr(e)}function Oo(t){t.qr=new Ye({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.Or.get(e)||null}}),Bo(t).start(),t.Br.Sr()}function So(t){return Do(t)&&!Bo(t).tr()&&t.Or.size>0}function Do(t){return 0===g(t).$r.size}function No(t){t.qr=void 0}function Ao(t){return Object(s.b)(this,void 0,void 0,(function(){return Object(s.d)(this,(function(e){return t.Or.forEach((function(e,n){Eo(t,e)})),[2]}))}))}function ko(t,e){return Object(s.b)(this,void 0,void 0,(function(){return Object(s.d)(this,(function(n){return No(t),So(t)?(t.Br.Nr(e),Oo(t)):t.Br.set("Unknown"),[2]}))}))}function jo(t,e,n){return Object(s.b)(this,void 0,void 0,(function(){var r,i,o;return Object(s.d)(this,(function(u){switch(u.label){case 0:if(t.Br.set("Online"),!(e instanceof We&&2===e.state&&e.cause))return[3,6];u.label=1;case 1:return u.trys.push([1,3,,5]),[4,function(t,e){return Object(s.b)(this,void 0,void 0,(function(){var n,r,i,o;return Object(s.d)(this,(function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?(o=i[r],t.Or.has(o)?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]):[3,5];case 2:s.sent(),t.Or.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return u.sent(),[3,5];case 3:return r=u.sent(),l("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,xo(t,r)];case 4:return u.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof Qe?t.qr.X(e):e instanceof ze?t.qr.rt(e):t.qr.et(e),n.isEqual(O.min()))return[3,13];u.label=7;case 7:return u.trys.push([7,11,,13]),[4,Ti(t.localStore)];case 8:return i=u.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.Or.get(r);i&&t.Or.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((function(e){var n=t.Or.get(e);if(n){t.Or.set(e,n.withResumeToken(R.EMPTY_BYTE_STRING,n.snapshotVersion)),To(t,e);var r=new vr(n.target,e,1,n.sequenceNumber);Eo(t,r)}})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:u.sent(),u.label=10;case 10:return[3,13];case 11:return l("RemoteStore","Failed to raise snapshot:",o=u.sent()),[4,xo(t,o)];case 12:return u.sent(),[3,13];case 13:return[2]}}))}))}function xo(t,e,n){return Object(s.b)(this,void 0,void 0,(function(){var r=this;return Object(s.d)(this,(function(i){switch(i.label){case 0:if(!ur(e))throw e;return t.$r.add(1),[4,wo(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return Ti(t.localStore)}),t.asyncQueue.enqueueRetryable((function(){return Object(s.b)(r,void 0,void 0,(function(){return Object(s.d)(this,(function(e){switch(e.label){case 0:return l("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.$r.delete(1),[4,bo(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function Co(t,e){return e().catch((function(n){return xo(t,n,e)}))}function Ro(t){return Object(s.b)(this,void 0,void 0,(function(){var e,n,r,i,o;return Object(s.d)(this,(function(s){switch(s.label){case 0:e=g(t),n=Ko(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return Do(t)&&t.kr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,Di(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.kr.push(e);var n=Ko(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,xo(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return Lo(e)&&Po(e),[2]}}))}))}function Lo(t){return Do(t)&&!Ko(t).tr()&&t.kr.length>0}function Po(t){Ko(t).start()}function Mo(t){return Object(s.b)(this,void 0,void 0,(function(){return Object(s.d)(this,(function(e){return Ko(t).Ar(),[2]}))}))}function Fo(t){return Object(s.b)(this,void 0,void 0,(function(){var e,n,r,i;return Object(s.d)(this,(function(o){for(e=Ko(t),n=0,r=t.kr;n<r.length;n++)i=r[n],e.Er(i.mutations);return[2]}))}))}function qo(t,e,n){return Object(s.b)(this,void 0,void 0,(function(){var r,i;return Object(s.d)(this,(function(o){switch(o.label){case 0:return r=t.kr.shift(),i=yr.from(r,e,n),[4,Co(t,(function(){return t.remoteSyncer.applySuccessfulWrite(i)}))];case 1:return o.sent(),[4,Ro(t)];case 2:return o.sent(),[2]}}))}))}function Vo(t,e){return Object(s.b)(this,void 0,void 0,(function(){return Object(s.d)(this,(function(n){switch(n.label){case 0:return e&&Ko(t).pr?[4,function(t,e){return Object(s.b)(this,void 0,void 0,(function(){var n,r;return Object(s.d)(this,(function(i){switch(i.label){case 0:return Se(r=e.code)&&r!==a.ABORTED?(n=t.kr.shift(),Ko(t).sr(),[4,Co(t,(function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)}))]):[3,3];case 1:return i.sent(),[4,Ro(t)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return Lo(t)&&Po(t),[2]}}))}))}function Uo(t,e){return Object(s.b)(this,void 0,void 0,(function(){var n;return Object(s.d)(this,(function(r){switch(r.label){case 0:return n=g(t),e?(n.$r.delete(2),[4,bo(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.$r.add(2),[4,wo(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function Bo(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=g(t);return r.br(),new po(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Ao.bind(null,t),Ri:ko.bind(null,t),_r:jo.bind(null,t)}),t.Mr.push((function(n){return Object(s.b)(e,void 0,void 0,(function(){return Object(s.d)(this,(function(e){switch(e.label){case 0:return n?(t.Ur.sr(),So(t)?Oo(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),No(t),e.label=3;case 3:return[2]}}))}))}))),t.Ur}function Ko(t){var e=this;return t.Qr||(t.Qr=function(t,e,n){var r=g(t);return r.br(),new yo(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Mo.bind(null,t),Ri:Vo.bind(null,t),Ir:Fo.bind(null,t),Tr:qo.bind(null,t)}),t.Mr.push((function(n){return Object(s.b)(e,void 0,void 0,(function(){return Object(s.d)(this,(function(e){switch(e.label){case 0:return n?(t.Qr.sr(),[4,Ro(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Qr.stop()];case 3:e.sent(),t.kr.length>0&&(l("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),e.label=4;case 4:return[2]}}))}))}))),t.Qr}var Go=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new er,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new c(a.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function Qo(t,e){if(d("AsyncQueue",e+": "+t),ur(t))return new c(a.UNAVAILABLE,e+": "+t);throw t}var zo=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||Q.comparator(e.key,n.key)}:function(t,e){return Q.comparator(t.key,e.key)},this.keyedMap=Pe(),this.sortedSet=new Ne(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),Wo=function(){function t(){this.Kr=new Ne(Q.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Kr.get(e);n?0!==t.type&&3===n.type?this.Kr=this.Kr.insert(e,t):3===t.type&&1!==n.type?this.Kr=this.Kr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Kr=this.Kr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Kr=this.Kr.remove(e):1===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):v():this.Kr=this.Kr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Kr.inorderTraversal((function(e,n){t.push(n)})),t},t}(),Ho=function(){function t(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=u}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,zo.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&qt(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Yo=function(){this.Wr=void 0,this.listeners=[]},Xo=function(){this.queries=new ni((function(t){return Vt(t)}),qt),this.onlineState="Unknown",this.Gr=new Set};function $o(t,e){return Object(s.b)(this,void 0,void 0,(function(){var n,r,i,o,u,a,c;return Object(s.d)(this,(function(s){switch(s.label){case 0:if(n=g(t),r=e.query,i=!1,(o=n.queries.get(r))||(i=!0,o=new Yo),!i)return[3,4];s.label=1;case 1:return s.trys.push([1,3,,4]),u=o,[4,n.onListen(r)];case 2:return u.Wr=s.sent(),[3,4];case 3:return a=s.sent(),c=Qo(a,"Initialization of query '"+Ut(e.query)+"' failed"),[2,void e.onError(c)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&es(n),[2]}}))}))}function Jo(t,e){return Object(s.b)(this,void 0,void 0,(function(){var n,r,i,o,u;return Object(s.d)(this,(function(s){return n=g(t),r=e.query,i=!1,(o=n.queries.get(r))&&(u=o.listeners.indexOf(e))>=0&&(o.listeners.splice(u,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]}))}))}function Zo(t,e){for(var n=g(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],u=s.query,a=n.queries.get(u);if(a){for(var c=0,h=a.listeners;c<h.length;c++)h[c].Hr(s)&&(r=!0);a.Wr=s}}r&&es(n)}function ts(t,e,n){var r=g(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function es(t){t.Gr.forEach((function(t){t.next()}))}var ns=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Ho(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.so&&n||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){if(t.docChanges.length>0)return!0;var e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=Ho.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),rs=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),is=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return cn(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?yn(this.R,t.document,!1):ut.newNoDocument(this.qn(t.metadata.name),this.Qn(t.metadata.readTime))},t.prototype.Qn=function(t){return on(t)},t}(),os=function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=ss(t)}return t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new is(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),u=0,a=o.metadata.queries;u<a.length;u++){var c=a[u],h=(e.get(c)||Ve()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return Object(s.b)(this,void 0,void 0,(function(){var t,e,n,r,i;return Object(s.d)(this,(function(o){switch(o.label){case 0:return[4,Ri(this.localStore,new is(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?(i=r[n],[4,Li(this.localStore,i,e.get(i.name))]):[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new vi(Object.assign({},this.progress),t))]}}))}))},t}();function ss(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var us=function(t){this.key=t},as=function(t){this.key=t},cs=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=Ve(),this.mutatedKeys=Ve(),this.lo=Kt(t),this.fo=new zo(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new Wo,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,u=!1,a=jt(this.query)&&i.size===this.query.limit?i.last():null,c=xt(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var h=i.get(t),f=Bt(n.query,e)?e:null,l=!!h&&n.mutatedKeys.has(h.key),d=!!f&&(f.hasLocalMutations||n.mutatedKeys.has(f.key)&&f.hasCommittedMutations),p=!1;h&&f?h.data.isEqual(f.data)?l!==d&&(r.track({type:3,doc:f}),p=!0):n.yo(h,f)||(r.track({type:2,doc:f}),p=!0,(a&&n.lo(f,a)>0||c&&n.lo(f,c)<0)&&(u=!0)):!h&&f?(r.track({type:0,doc:f}),p=!0):h&&!f&&(r.track({type:1,doc:h}),p=!0,(a||c)&&(u=!0)),p&&(f?(s=s.add(f),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),jt(this.query)||xt(this.query))for(;s.size>this.query.limit;){var h=jt(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:u,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return v()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)})),this.po(n);var s=e?this.Eo():[],u=0===this.ho.size&&this.current?1:0,a=u!==this.ao;return this.ao=u,0!==o.length||a?{snapshot:new Ho(this.query,t.fo,i,o,t.mutatedKeys,0===u,a,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Wo,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e.uo=e.uo.add(t)})),t.modifiedDocuments.forEach((function(t){})),t.removedDocuments.forEach((function(t){return e.uo=e.uo.delete(t)})),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=Ve(),this.fo.forEach((function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))}));var n=[];return e.forEach((function(e){t.ho.has(e)||n.push(new as(e))})),this.ho.forEach((function(t){e.has(t)||n.push(new us(t))})),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=Ve();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return Ho.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),hs=function(t,e,n){this.query=t,this.targetId=e,this.view=n},fs=function(t){this.key=t,this.bo=!1},ls=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new ni((function(t){return Vt(t)}),qt),this.Vo=new Map,this.So=new Set,this.Do=new Ne(Q.comparator),this.Co=new Map,this.No=new Mi,this.xo={},this.Fo=new Map,this.ko=Gr.Yt(),this.onlineState="Unknown",this.Oo=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.Oo},enumerable:!1,configurable:!0}),t}();function ds(t,e){return Object(s.b)(this,void 0,void 0,(function(){var n,r,i,o,u,a;return Object(s.d)(this,(function(s){switch(s.label){case 0:return n=Bs(t),(o=n.Po.get(e))?(r=o.targetId,n.sharedClientState.addLocalQueryTarget(r),i=o.view.Ro(),[3,4]):[3,1];case 1:return[4,Ni(n.localStore,Mt(e))];case 2:return u=s.sent(),a=n.sharedClientState.addLocalQueryTarget(u.targetId),r=u.targetId,[4,ps(n,e,r,"current"===a)];case 3:i=s.sent(),n.isPrimaryClient&&Io(n.remoteStore,u),s.label=4;case 4:return[2,i]}}))}))}function ps(t,e,n,r){return Object(s.b)(this,void 0,void 0,(function(){var i,o,u,a,c,h;return Object(s.d)(this,(function(f){switch(f.label){case 0:return t.$o=function(e,n,r){return function(t,e,n,r){return Object(s.b)(this,void 0,void 0,(function(){var i,o,u;return Object(s.d)(this,(function(s){switch(s.label){case 0:return(i=e.view._o(n)).Nn?[4,ki(t.localStore,e.query,!1).then((function(t){var n=t.documents;return e.view._o(n,i)}))]:[3,2];case 1:i=s.sent(),s.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),u=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(Ds(t,e.targetId,u.To),u.snapshot)]}}))}))}(t,e,n,r)},[4,ki(t.localStore,e,!0)];case 1:return i=f.sent(),o=new cs(e,i.Bn),u=o._o(i.documents),a=Ge.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),c=o.applyChanges(u,t.isPrimaryClient,a),Ds(t,n,c.To),h=new hs(e,n,o),[2,(t.Po.set(e,h),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),c.snapshot)]}}))}))}function ys(t,e){return Object(s.b)(this,void 0,void 0,(function(){var n,r,i;return Object(s.d)(this,(function(o){switch(o.label){case 0:return n=g(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter((function(t){return!qt(t,e)}))),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,Ai(n.localStore,r.targetId,!1).then((function(){n.sharedClientState.clearQueryState(r.targetId),_o(n.remoteStore,r.targetId),Os(n,r.targetId)})).catch(Yr)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return Os(n,r.targetId),[4,Ai(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))}function vs(t,e,n){return Object(s.b)(this,void 0,void 0,(function(){var r,i,o,u;return Object(s.d)(this,(function(s){switch(s.label){case 0:r=Ks(t),s.label=1;case 1:return s.trys.push([1,5,,6]),[4,function(t,e){var n,r=g(t),i=T.now(),o=e.reduce((function(t,e){return t.add(e.key)}),Ve());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return r.Mn.pn(t,o).next((function(o){n=o;for(var s=[],u=0,a=e;u<a.length;u++){var c=a[u],h=de(c,n.get(c.key));null!=h&&s.push(new me(c.key,h,st(h.toProto().mapValue),ae.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)}))})).then((function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}}))}(r.localStore,e)];case 2:return i=s.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Ne(I)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,ks(r,i.changes)];case 3:return s.sent(),[4,Ro(r.remoteStore)];case 4:return s.sent(),[3,6];case 5:return o=s.sent(),u=Qo(o,"Failed to persist write"),n.reject(u),[3,6];case 6:return[2]}}))}))}function ms(t,e){return Object(s.b)(this,void 0,void 0,(function(){var n,r;return Object(s.d)(this,(function(i){switch(i.label){case 0:n=g(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Oi(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach((function(t,e){var r=n.Co.get(e);r&&(m(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?m(r.bo):t.removedDocuments.size>0&&(m(r.bo),r.bo=!1))})),[4,ks(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,Yr(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function gs(t,e,n){var r=g(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach((function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=g(t);n.onlineState=e;var r=!1;n.queries.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)})),r&&es(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function bs(t,e,n){return Object(s.b)(this,void 0,void 0,(function(){var r,i,o,u,a,c;return Object(s.d)(this,(function(s){switch(s.label){case 0:return(r=g(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(u=(u=new Ne(Q.comparator)).insert(o,ut.newNoDocument(o,O.min())),a=Ve().add(o),c=new Ke(O.min(),new Map,new je(I),u,a),[4,ms(r,c)]):[3,2];case 1:return s.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),As(r),[3,4];case 2:return[4,Ai(r.localStore,e,!1).then((function(){return Os(r,e,n)})).catch(Yr)];case 3:s.sent(),s.label=4;case 4:return[2]}}))}))}function ws(t,e){return Object(s.b)(this,void 0,void 0,(function(){var n,r,i;return Object(s.d)(this,(function(o){switch(o.label){case 0:n=g(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,Ei(n.localStore,e)];case 2:return i=o.sent(),Ts(n,r,null),Es(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,ks(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,Yr(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function Is(t,e,n){return Object(s.b)(this,void 0,void 0,(function(){var r,i;return Object(s.d)(this,(function(o){switch(o.label){case 0:r=g(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=g(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var r;return n._n.lookupMutationBatch(t,e).next((function(e){return m(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}(r.localStore,e)];case 2:return i=o.sent(),Ts(r,e,n),Es(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,ks(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,Yr(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function _s(t,e){return Object(s.b)(this,void 0,void 0,(function(){var n,r,i,o,u;return Object(s.d)(this,(function(s){switch(s.label){case 0:Do((n=g(t)).remoteStore)||l("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,function(t){var e=g(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e._n.getHighestUnacknowledgedBatchId(t)}))}(n.localStore)];case 2:return-1===(r=s.sent())?[2,void e.resolve()]:((i=n.Fo.get(r)||[]).push(e),n.Fo.set(r,i),[3,4]);case 3:return o=s.sent(),u=Qo(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(u),[3,4];case 4:return[2]}}))}))}function Es(t,e){(t.Fo.get(e)||[]).forEach((function(t){t.resolve()})),t.Fo.delete(e)}function Ts(t,e,n){var r=g(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function Os(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach((function(e){t.No.containsKey(e)||Ss(t,e)}))}function Ss(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(_o(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),As(t))}function Ds(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof us?(t.No.addReference(o.key,e),Ns(t,o)):o instanceof as?(l("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||Ss(t,o.key)):v()}}function Ns(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(l("SyncEngine","New document in limbo: "+n),t.So.add(r),As(t))}function As(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new Q(k.fromString(e)),r=t.ko.next();t.Co.set(r,new fs(n)),t.Do=t.Do.insert(n,r),Io(t.remoteStore,new vr(Mt(kt(n.path)),r,2,u.o))}}function ks(t,e,n){return Object(s.b)(this,void 0,void 0,(function(){var r,i,o,u;return Object(s.d)(this,(function(a){switch(a.label){case 0:return r=g(t),i=[],o=[],u=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach((function(t,s){u.push(r.$o(s,e,n).then((function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(s.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=gi.Pn(s.targetId,t);o.push(e)}})))})),[4,Promise.all(u)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return Object(s.b)(this,void 0,void 0,(function(){var n,r,i,o,u,a,c,h,f;return Object(s.d)(this,(function(s){switch(s.label){case 0:n=g(t),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return nr.forEach(e,(function(e){return nr.forEach(e.bn,(function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)})).next((function(){return nr.forEach(e.vn,(function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)}))}))}))}))];case 2:return s.sent(),[3,4];case 3:if(!ur(r=s.sent()))throw r;return l("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)u=o[i],a=u.targetId,u.fromCache||(c=n.Fn.get(a),h=c.snapshotVersion,f=c.withLastLimboFreeSnapshotVersion(h),n.Fn=n.Fn.insert(a,f));return[2]}}))}))}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}}))}))}function js(t,e){return Object(s.b)(this,void 0,void 0,(function(){var n,r;return Object(s.d)(this,(function(i){switch(i.label){case 0:return(n=g(t)).currentUser.isEqual(e)?[3,3]:(l("SyncEngine","User change. New user:",e.toKey()),[4,_i(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Fo.forEach((function(t){t.forEach((function(t){t.reject(new c(a.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Fo.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,ks(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}function xs(t,e){var n=g(t),r=n.Co.get(e);if(r&&r.bo)return Ve().add(r.key);var i=Ve(),o=n.Vo.get(e);if(!o)return i;for(var s=0,u=o;s<u.length;s++){var a=u[s],c=n.Po.get(a);i=i.unionWith(c.view.wo)}return i}function Cs(t,e){return Object(s.b)(this,void 0,void 0,(function(){var n,r,i;return Object(s.d)(this,(function(o){switch(o.label){case 0:return[4,ki((n=g(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&Ds(n,e.targetId,i.To),i)]}}))}))}function Rs(t){return Object(s.b)(this,void 0,void 0,(function(){var e;return Object(s.d)(this,(function(n){return[2,xi((e=g(t)).localStore).then((function(t){return ks(e,t)}))]}))}))}function Ls(t,e,n,r){return Object(s.b)(this,void 0,void 0,(function(){var i,o;return Object(s.d)(this,(function(s){switch(s.label){case 0:return[4,function(t,e){var n=g(t),r=g(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.jt(t,e).next((function(e){return e?n.Mn.pn(t,e):nr.resolve(null)}))}))}((i=g(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,Ro(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Ts(i,e,r||null),Es(i,e),function(t,e){g(g(t)._n).Gt(e)}(i.localStore,e)):v(),s.label=4;case 4:return[4,ks(i,o)];case 5:return s.sent(),[3,7];case 6:l("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}}))}))}function Ps(t,e){return Object(s.b)(this,void 0,void 0,(function(){var n,r,i,o,u,a,c,h;return Object(s.d)(this,(function(s){switch(s.label){case 0:return Bs(n=g(t)),Ks(n),!0!==e||!0===n.Oo?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,Ms(n,r.toArray())]);case 1:return i=s.sent(),n.Oo=!0,[4,Uo(n.remoteStore,!0)];case 2:for(s.sent(),o=0,u=i;o<u.length;o++)a=u[o],Io(n.remoteStore,a);return[3,7];case 3:return!1!==e||!1===n.Oo?[3,7]:(c=[],h=Promise.resolve(),n.Vo.forEach((function(t,e){n.sharedClientState.isLocalQueryTarget(e)?c.push(e):h=h.then((function(){return Os(n,e),Ai(n.localStore,e,!0)})),_o(n.remoteStore,e)})),[4,h]);case 4:return s.sent(),[4,Ms(n,c)];case 5:return s.sent(),function(t){var e=g(t);e.Co.forEach((function(t,n){_o(e.remoteStore,n)})),e.No.ts(),e.Co=new Map,e.Do=new Ne(Q.comparator)}(n),n.Oo=!1,[4,Uo(n.remoteStore,!1)];case 6:s.sent(),s.label=7;case 7:return[2]}}))}))}function Ms(t,e,n){return Object(s.b)(this,void 0,void 0,(function(){var n,r,i,o,u,a,c,h,f,l,d,p,y,v;return Object(s.d)(this,(function(s){switch(s.label){case 0:n=g(t),r=[],i=[],o=0,u=e,s.label=1;case 1:return o<u.length?(a=u[o],c=void 0,(h=n.Vo.get(a))&&0!==h.length?[4,Ni(n.localStore,Mt(h[0]))]:[3,7]):[3,13];case 2:c=s.sent(),f=0,l=h,s.label=3;case 3:return f<l.length?(d=l[f],p=n.Po.get(d),[4,Cs(n,p)]):[3,6];case 4:(y=s.sent()).snapshot&&i.push(y.snapshot),s.label=5;case 5:return f++,[3,3];case 6:return[3,11];case 7:return[4,ji(n.localStore,a)];case 8:return v=s.sent(),[4,Ni(n.localStore,v)];case 9:return c=s.sent(),[4,ps(n,Fs(v),a,!1)];case 10:s.sent(),s.label=11;case 11:r.push(c),s.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}}))}))}function Fs(t){return At(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function qs(t){var e=g(t);return g(g(e.localStore).persistence).fn()}function Vs(t,e,n,r){return Object(s.b)(this,void 0,void 0,(function(){var i,o,u;return Object(s.d)(this,(function(s){switch(s.label){case 0:return(i=g(t)).Oo?(l("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,xi(i.localStore)];case 3:return o=s.sent(),u=Ke.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,ks(i,o,u)];case 4:return s.sent(),[3,8];case 5:return[4,Ai(i.localStore,e,!0)];case 6:return s.sent(),Os(i,e,r),[3,8];case 7:v(),s.label=8;case 8:return[2]}}))}))}function Us(t,e,n){return Object(s.b)(this,void 0,void 0,(function(){var r,i,o,u,a,c,h,f,d,p;return Object(s.d)(this,(function(y){switch(y.label){case 0:if(!(r=Bs(t)).Oo)return[3,10];i=0,o=e,y.label=1;case 1:return i<o.length?(u=o[i],r.Vo.has(u)?(l("SyncEngine","Adding an already active target "+u),[3,5]):[4,ji(r.localStore,u)]):[3,6];case 2:return a=y.sent(),[4,Ni(r.localStore,a)];case 3:return c=y.sent(),[4,ps(r,Fs(a),c.targetId,!1)];case 4:y.sent(),Io(r.remoteStore,c),y.label=5;case 5:return i++,[3,1];case 6:h=function(t){return Object(s.d)(this,(function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,Ai(r.localStore,t,!1).then((function(){_o(r.remoteStore,t),Os(r,t)})).catch(Yr)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},f=0,d=n,y.label=7;case 7:return f<d.length?(p=d[f],[5,h(p)]):[3,10];case 8:y.sent(),y.label=9;case 9:return f++,[3,7];case 10:return[2]}}))}))}function Bs(t){var e=g(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=ms.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=xs.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=bs.bind(null,e),e.vo._r=Zo.bind(null,e.eventManager),e.vo.Mo=ts.bind(null,e.eventManager),e}function Ks(t){var e=g(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ws.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Is.bind(null,e),e}function Gs(t,e,n){var r=g(t);(function(t,e,n){return Object(s.b)(this,void 0,void 0,(function(){var r,i,o,u,a,c;return Object(s.d)(this,(function(s){switch(s.label){case 0:return s.trys.push([0,14,,15]),[4,e.getMetadata()];case 1:return r=s.sent(),[4,function(t,e){var n=g(t),r=on(e.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(function(t){return n.Qe.getBundleMetadata(t,e.id)})).then((function(t){return!!t&&t.createTime.compareTo(r)>=0}))}(t.localStore,r)];case 2:return s.sent()?[4,e.close()]:[3,4];case 3:return[2,(s.sent(),void n._completeWith(function(t){return{taskState:"Success",documentsLoaded:t.totalDocuments,bytesLoaded:t.totalBytes,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(r)))];case 4:return n._updateProgress(ss(r)),i=new os(r,t.localStore,e.R),[4,e.Lo()];case 5:o=s.sent(),s.label=6;case 6:return o?[4,i.oo(o)]:[3,10];case 7:return(u=s.sent())&&n._updateProgress(u),[4,e.Lo()];case 8:o=s.sent(),s.label=9;case 9:return[3,6];case 10:return[4,i.complete()];case 11:return a=s.sent(),[4,ks(t,a.wn,void 0)];case 12:return s.sent(),[4,function(t,e){var n=g(t);return n.persistence.runTransaction("Save bundle","readwrite",(function(t){return n.Qe.saveBundleMetadata(t,e)}))}(t.localStore,r)];case 13:return s.sent(),n._completeWith(a.progress),[3,15];case 14:return p("SyncEngine","Loading bundle failed with "+(c=s.sent())),n._failWith(c),[3,15];case 15:return[2]}}))}))})(r,e,n).then((function(){r.sharedClientState.notifyBundleLoaded()}))}var Qs=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(s.b)(this,void 0,void 0,(function(){return Object(s.d)(this,(function(e){switch(e.label){case 0:return this.R=ho(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Qo(t),[2]}}))}))},t.prototype.Uo=function(t){return null},t.prototype.Qo=function(t){return Ii(this.persistence,new bi,t.initialUser,this.R)},t.prototype.qo=function(t){return new Ki(Qi.bs,this.R)},t.prototype.Bo=function(t){return new no},t.prototype.terminate=function(){return Object(s.b)(this,void 0,void 0,(function(){return Object(s.d)(this,(function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}}))}))},t}(),zs=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Ko=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(s.c)(e,t),e.prototype.initialize=function(e){return Object(s.b)(this,void 0,void 0,(function(){return Object(s.d)(this,(function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,Ci(this.localStore)];case 2:return n.sent(),[4,this.Ko.initialize(this,e)];case 3:return n.sent(),[4,Ks(this.Ko.syncEngine)];case 4:return n.sent(),[4,Ro(this.Ko.remoteStore)];case 5:return n.sent(),[2]}}))}))},e.prototype.Qo=function(t){return Ii(this.persistence,new bi,t.initialUser,this.R)},e.prototype.Uo=function(t){var e=this.persistence.referenceDelegate.garbageCollector;return new Jr(e,t.asyncQueue)},e.prototype.qo=function(t){var e=yi(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Pr.withCacheSize(this.cacheSizeBytes):Pr.DEFAULT;return new li(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,ao(),co(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new no},e}(Qs),Ws=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Ko=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(s.c)(e,t),e.prototype.initialize=function(e){return Object(s.b)(this,void 0,void 0,(function(){var n,r=this;return Object(s.d)(this,(function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Ko.syncEngine,this.sharedClientState instanceof eo?(this.sharedClientState.syncEngine={ui:Ls.bind(null,n),ai:Vs.bind(null,n),hi:Us.bind(null,n),fn:qs.bind(null,n),ci:Rs.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He((function(t){return Object(s.b)(r,void 0,void 0,(function(){return Object(s.d)(this,(function(e){switch(e.label){case 0:return[4,Ps(this.Ko.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}}))}))}))];case 4:return i.sent(),[2]}}))}))},e.prototype.Bo=function(t){var e=ao();if(!eo.yt(e))throw new c(a.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=yi(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new eo(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(zs),Hs=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(s.b)(this,void 0,void 0,(function(){var n=this;return Object(s.d)(this,(function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return gs(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=js.bind(null,this.syncEngine),[4,Uo(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.createEventManager=function(t){return new Xo},t.prototype.createDatastore=function(t){var e,n=ho(t.databaseInfo.databaseId),r=(e=t.databaseInfo,new uo(e));return function(t,e,n){return new vo(t,e,n)}(t.credentials,r,n)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return gs(s.syncEngine,t,0)},o=io.yt()?new io:new ro,new go(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var u=new ls(t,e,n,r,i,o);return s&&(u.Oo=!0),u}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return Object(s.b)(this,void 0,void 0,(function(){var e;return Object(s.d)(this,(function(n){switch(n.label){case 0:return e=g(t),l("RemoteStore","RemoteStore shutting down."),e.$r.add(5),[4,wo(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}}))}))}(this.remoteStore)},t}();function Ys(t,e){void 0===e&&(e=10240);var n=0;return{read:function(){return Object(s.b)(this,void 0,void 0,(function(){var r;return Object(s.d)(this,(function(i){return n<t.byteLength?(r={value:t.slice(n,n+e),done:!1},[2,(n+=e,r)]):[2,{done:!0}]}))}))},cancel:function(){return Object(s.b)(this,void 0,void 0,(function(){return Object(s.d)(this,(function(t){return[2]}))}))},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var Xs=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),$s=function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new er,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then((function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))}),(function(t){return n.metadata.reject(t)}))}return t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return Object(s.b)(this,void 0,void 0,(function(){return Object(s.d)(this,(function(t){return[2,this.metadata.promise]}))}))},t.prototype.Lo=function(){return Object(s.b)(this,void 0,void 0,(function(){return Object(s.d)(this,(function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}}))}))},t.prototype.Ho=function(){return Object(s.b)(this,void 0,void 0,(function(){var t,e,n,r;return Object(s.d)(this,(function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new rs(JSON.parse(r),t.length+n)]}}))}))},t.prototype.Zo=function(){return this.buffer.findIndex((function(t){return t==="{".charCodeAt(0)}))},t.prototype.Jo=function(){return Object(s.b)(this,void 0,void 0,(function(){var t,e;return Object(s.d)(this,(function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}}))}))},t.prototype.Xo=function(t){return Object(s.b)(this,void 0,void 0,(function(){var e;return Object(s.d)(this,(function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}}))}))},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return Object(s.b)(this,void 0,void 0,(function(){var t,e;return Object(s.d)(this,(function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}}))}))},t}(),Js=function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(s.b)(this,void 0,void 0,(function(){var e,n=this;return Object(s.d)(this,(function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new c(a.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(s.b)(this,void 0,void 0,(function(){var n,r,i,o,u,a;return Object(s.d)(this,(function(s){switch(s.label){case 0:return n=g(t),r=ln(n.R)+"/documents",i={documents:e.map((function(t){return an(n.R,t)}))},[4,n.Oi("BatchGetDocuments",r,i)];case 1:return o=s.sent(),u=new Map,o.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){m(!!e.found),e.found.name,e.found.updateTime;var n=cn(t,e.found.name),r=on(e.found.updateTime),i=new ot({mapValue:{fields:e.found.fields}});return ut.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){m(!!e.missing),m(!!e.readTime);var n=cn(t,e.missing),r=on(e.readTime);return ut.newNoDocument(n,r)}(t,e):v()}(n.R,t);u.set(e.key.toString(),e)})),a=[],[2,(e.forEach((function(t){var e=u.get(t.toString());m(!!e),a.push(e)})),a)]}}))}))}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach((function(t){return n.recordVersion(t)})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new Ee(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return Object(s.b)(this,void 0,void 0,(function(){var t,e=this;return Object(s.d)(this,(function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=Q.fromPath(n);e.mutations.push(new Te(r,e.precondition(r)))})),[4,function(t,e){return Object(s.b)(this,void 0,void 0,(function(){var n,r,i;return Object(s.d)(this,(function(o){switch(o.label){case 0:return n=g(t),r=ln(n.R)+"/documents",i={writes:e.map((function(t){return vn(n.R,t)}))},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}}))}))}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}}))}))},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw v();e=O.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new c(a.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?ae.updateTime(e):ae.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(O.min()))throw new c(a.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ae.updateTime(e)}return ae.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}(),Zs=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new fo(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji((function(){return Object(s.b)(t,void 0,void 0,(function(){var t,e,n=this;return Object(s.d)(this,(function(r){return t=new Js(this.datastore),(e=this.sc(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.ic(t)}))}))})).catch((function(t){n.ic(t)})),[2]}))}))}))},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!B(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget((function(){return e.nc(),Promise.resolve()}))):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Se(e)}return!1},t}(),tu=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=zi.UNAUTHENTICATED,this.clientId=w.u(),this.credentialListener=function(){},this.receivedInitialUser=new er,this.credentials.setChangeListener((function(t){l("FirestoreClient","Received user=",t.uid),r.user=t,r.credentialListener(t),r.receivedInitialUser.resolve()}))}return t.prototype.getConfiguration=function(){return Object(s.b)(this,void 0,void 0,(function(){return Object(s.d)(this,(function(t){switch(t.label){case 0:return[4,this.receivedInitialUser.promise];case 1:return[2,(t.sent(),{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100})]}}))}))},t.prototype.setCredentialChangeListener=function(t){var e=this;this.credentialListener=t,this.receivedInitialUser.promise.then((function(){return e.credentialListener(e.user)}))},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new c(a.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new er;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((function(){return Object(s.b)(t,void 0,void 0,(function(){var t,n;return Object(s.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=Qo(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}}))}))})),e.promise},t}();function eu(t,e){return Object(s.b)(this,void 0,void 0,(function(){var n,r,i=this;return Object(s.d)(this,(function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),l("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener((function(n){r.isEqual(n)||(r=n,t.asyncQueue.enqueueRetryable((function(){return Object(s.b)(i,void 0,void 0,(function(){return Object(s.d)(this,(function(t){switch(t.label){case 0:return[4,_i(e.localStore,n)];case 1:return t.sent(),[2]}}))}))})))})),e.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=e,[2]}}))}))}function nu(t,e){return Object(s.b)(this,void 0,void 0,(function(){var n,r;return Object(s.d)(this,(function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,ru(t)];case 1:return n=i.sent(),l("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener((function(n){return t.asyncQueue.enqueueRetryable((function(){return function(t,e){return Object(s.b)(this,void 0,void 0,(function(){var n,r;return Object(s.d)(this,(function(i){switch(i.label){case 0:return(n=g(t)).asyncQueue.verifyOperationInProgress(),l("RemoteStore","RemoteStore received new credentials"),r=Do(n),n.$r.add(3),[4,wo(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.$r.delete(3),[4,bo(n)];case 3:return i.sent(),[2]}}))}))}(e.remoteStore,n)}))})),t.onlineComponents=e,[2]}}))}))}function ru(t){return Object(s.b)(this,void 0,void 0,(function(){return Object(s.d)(this,(function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(l("FirestoreClient","Using default OfflineComponentProvider"),[4,eu(t,new Qs)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}}))}))}function iu(t){return Object(s.b)(this,void 0,void 0,(function(){return Object(s.d)(this,(function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(l("FirestoreClient","Using default OnlineComponentProvider"),[4,nu(t,new Hs)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}}))}))}function ou(t){return ru(t).then((function(t){return t.persistence}))}function su(t){return ru(t).then((function(t){return t.localStore}))}function uu(t){return iu(t).then((function(t){return t.remoteStore}))}function au(t){return iu(t).then((function(t){return t.syncEngine}))}function cu(t){return Object(s.b)(this,void 0,void 0,(function(){var e,n;return Object(s.d)(this,(function(r){switch(r.label){case 0:return[4,iu(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=ds.bind(null,e.syncEngine),n.onUnlisten=ys.bind(null,e.syncEngine),n)]}}))}))}function hu(t,e,n){var r=this;void 0===n&&(n={});var i=new er;return t.asyncQueue.enqueueAndForget((function(){return Object(s.b)(r,void 0,void 0,(function(){var r;return Object(s.d)(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new Xs({next:function(o){e.enqueueAndForget((function(){return Jo(t,s)}));var u=o.docs.has(n);!u&&o.fromCache?i.reject(new c(a.UNAVAILABLE,"Failed to get document because the client is offline.")):u&&o.fromCache&&r&&"server"===r.source?i.reject(new c(a.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new ns(kt(n.path),o,{includeMetadataChanges:!0,so:!0});return $o(t,s)},[4,cu(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}function fu(t,e,n){var r=this;void 0===n&&(n={});var i=new er;return t.asyncQueue.enqueueAndForget((function(){return Object(s.b)(r,void 0,void 0,(function(){var r;return Object(s.d)(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new Xs({next:function(n){e.enqueueAndForget((function(){return Jo(t,s)})),n.fromCache&&"server"===r.source?i.reject(new c(a.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new ns(n,o,{includeMetadataChanges:!0,so:!0});return $o(t,s)},[4,cu(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}var lu=function(t,e,n,r,i,o,s){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s},du=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),pu=new Map,yu=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},vu=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){this.changeListener=t,t(zi.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),mu=function(){function t(t){var e=this;this.oc=null,this.currentUser=zi.UNAUTHENTICATED,this.receivedInitialUser=!1,this.cc=0,this.changeListener=null,this.forceRefresh=!1,this.oc=function(){e.cc++,e.currentUser=e.uc(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.cc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.oc):(this.oc(null),t.get().then((function(t){e.auth=t,e.oc&&e.auth.addAuthTokenListener(e.oc)}),(function(){})))}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.cc!==e?(l("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(m("string"==typeof n.accessToken),new yu(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.oc),this.oc=null,this.changeListener=null},t.prototype.uc=function(){var t=this.auth&&this.auth.getUid();return m(null===t||"string"==typeof t),new zi(t)},t}(),gu=function(){function t(t,e,n){this.ac=t,this.hc=e,this.lc=n,this.type="FirstParty",this.user=zi.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.hc},e=this.ac.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.lc&&(t["X-Goog-Iam-Authorization-Token"]=this.lc),t},enumerable:!1,configurable:!0}),t}(),bu=function(){function t(t,e,n){this.ac=t,this.hc=e,this.lc=n}return t.prototype.getToken=function(){return Promise.resolve(new gu(this.ac,this.hc,this.lc))},t.prototype.setChangeListener=function(t){t(zi.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function wu(t,e,n){if(!n)throw new c(a.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Iu(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new c(a.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function _u(t,e,n,r){if(!0===e&&!0===r)throw new c(a.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Eu(t){if(!Q.isDocumentKey(t))throw new c(a.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Tu(t){if(Q.isDocumentKey(t))throw new c(a.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Ou(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":v()}function Su(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new c(a.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Ou(t);throw new c(a.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function Du(t,e){if(e<=0)throw new c(a.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Nu=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new c(a.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new c(a.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,_u("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),Au=function(){function t(t,e){this._persistenceKey="(lite)",this._settings=new Nu({}),this._settingsFrozen=!1,t instanceof du?(this._databaseId=t,this._credentials=new vu):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new c(a.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new du(t.options.projectId)}(t),this._credentials=new mu(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new c(a.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new c(a.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Nu(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new vu;switch(t.type){case"gapi":var e=t.client;return m(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new bu(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new c(a.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return this,(t=pu.get(this))&&(l("ComponentProvider","Removing Datastore"),pu.delete(this),t.terminate()),Promise.resolve();var t},t}(),ku=function(){function t(t,e,n){this._converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new xu(this.firestore,this._converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),ju=function(){function t(t,e,n){this._converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),xu=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,kt(r))||this)._path=r,i.type="collection",i}return Object(s.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new ku(this.firestore,null,new Q(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(ju);function Cu(t,e){for(var n,i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];if(t=Object(r.p)(t),wu("collection","path",e),t instanceof Au)return Tu(n=k.fromString.apply(k,Object(s.f)([e],i))),new xu(t,null,n);if(!(t instanceof ku||t instanceof xu))throw new c(a.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Tu(n=k.fromString.apply(k,Object(s.f)([t.path],i)).child(k.fromString(e))),new xu(t.firestore,null,n)}function Ru(t,e){for(var n,i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];if(t=Object(r.p)(t),1===arguments.length&&(e=w.u()),wu("doc","path",e),t instanceof Au)return Eu(n=k.fromString.apply(k,Object(s.f)([e],i))),new ku(t,null,new Q(n));if(!(t instanceof ku||t instanceof xu))throw new c(a.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Eu(n=t._path.child(k.fromString.apply(k,Object(s.f)([e],i)))),new ku(t.firestore,t instanceof xu?t._converter:null,new Q(n))}function Lu(t,e){return t=Object(r.p)(t),e=Object(r.p)(e),(t instanceof ku||t instanceof xu)&&(e instanceof ku||e instanceof xu)&&t.firestore===e.firestore&&t.path===e.path&&t._converter===e._converter}function Pu(t,e){return t=Object(r.p)(t),e=Object(r.p)(e),t instanceof ju&&e instanceof ju&&t.firestore===e.firestore&&qt(t._query,e._query)&&t._converter===e._converter}var Mu=function(){function t(){var t=this;this.fc=Promise.resolve(),this.dc=[],this.wc=!1,this._c=[],this.mc=null,this.yc=!1,this.gc=[],this.Zi=new fo(this,"async_queue_retry"),this.Ec=function(){var e=co();e&&l("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=co();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ec)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this.wc},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Tc(),this.Ic(t)},t.prototype.enterRestrictedMode=function(){if(!this.wc){this.wc=!0;var t=co();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ec)}},t.prototype.enqueue=function(t){return this.Tc(),this.wc?new Promise((function(t){})):this.Ic(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget((function(){return e.dc.push(t),e.Ac()}))},t.prototype.Ac=function(){return Object(s.b)(this,void 0,void 0,(function(){var t,e=this;return Object(s.d)(this,(function(n){switch(n.label){case 0:if(0===this.dc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.dc[0]()];case 2:return n.sent(),this.dc.shift(),this.Zi.reset(),[3,4];case 3:if(!ur(t=n.sent()))throw t;return l("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.dc.length>0&&this.Zi.ji((function(){return e.Ac()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Ic=function(t){var e=this,n=this.fc.then((function(){return e.yc=!0,t().catch((function(t){throw e.mc=t,e.yc=!1,d("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.yc=!1,t}))}));return this.fc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Tc(),this.gc.indexOf(t)>-1&&(e=0);var i=Go.createAndSchedule(this,t,e,n,(function(t){return r.Rc(t)}));return this._c.push(i),i},t.prototype.Tc=function(){this.mc&&v()},t.prototype.verifyOperationInProgress=function(){},t.prototype.bc=function(){return Object(s.b)(this,void 0,void 0,(function(){var t;return Object(s.d)(this,(function(e){switch(e.label){case 0:return[4,t=this.fc];case 1:e.sent(),e.label=2;case 2:if(t!==this.fc)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.vc=function(t){for(var e=0,n=this._c;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Pc=function(t){var e=this;return this.bc().then((function(){e._c.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e._c;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.bc()}))},t.prototype.Vc=function(t){this.gc.push(t)},t.prototype.Rc=function(t){var e=this._c.indexOf(t);this._c.splice(e,1)},t}();function Fu(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var qu=function(){function t(){this._progressObserver={},this._taskCompletionResolver=new er,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}return t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)},t}(),Vu=-1,Uu=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._queue=new Mu,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return Object(s.c)(e,t),e.prototype._terminate=function(){return this._firestoreClient||Ku(this),this._firestoreClient.terminate()},e}(Au);function Bu(t){return t._firestoreClient||Ku(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Ku(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new lu(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new tu(t._credentials,t._queue,r)}function Gu(t,e,n){var r=this,i=new er;return t.asyncQueue.enqueue((function(){return Object(s.b)(r,void 0,void 0,(function(){var r;return Object(s.d)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,eu(t,n)];case 1:return o.sent(),[4,nu(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===a.FAILED_PRECONDITION||t.code===a.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}}))}))})).then((function(){return i.promise}))}function Qu(t){if(t._initialized||t._terminated)throw new c(a.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var zu=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new c(a.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new x(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),Wu=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(R.fromBase64String(e))}catch(e){throw new c(a.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(R.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),Hu=function(t){this._methodName=t},Yu=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new c(a.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new c(a.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return I(this._lat,t._lat)||I(this._long,t._long)},t}(),Xu=/^__.*__$/,$u=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new me(t,this.data,this.fieldMask,e,this.fieldTransforms):new ve(t,this.data,e,this.fieldTransforms)},t}(),Ju=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new me(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function Zu(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw v()}}var ta=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Sc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dc",{get:function(){return this.settings.Dc},enumerable:!1,configurable:!0}),t.prototype.Cc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.Nc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Cc({path:n,xc:!1});return r.Fc(t),r},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Cc({path:n,xc:!1});return r.Sc(),r},t.prototype.Oc=function(t){return this.Cc({path:void 0,xc:!0})},t.prototype.$c=function(t){return wa(t,this.settings.methodName,this.settings.Mc||!1,this.path,this.settings.Lc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},t.prototype.Sc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Fc(this.path.get(t))},t.prototype.Fc=function(t){if(0===t.length)throw this.$c("Document fields must not be empty");if(Zu(this.Dc)&&Xu.test(t))throw this.$c('Document fields cannot begin and end with "__"')},t}(),ea=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||ho(t)}return t.prototype.Bc=function(t,e,n,r){return void 0===r&&(r=!1),new ta({Dc:t,methodName:e,Lc:n,path:x.emptyPath(),xc:!1,Mc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function na(t){var e=t._freezeSettings(),n=ho(t._databaseId);return new ea(t._databaseId,!!e.ignoreUndefinedProperties,n)}function ra(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Bc(o.merge||o.mergeFields?2:0,e,n,i);va("Data must be an object, but it was:",s,r);var u,h,f=pa(r,s);if(o.merge)u=new C(s.fieldMask),h=s.fieldTransforms;else if(o.mergeFields){for(var l=[],d=0,p=o.mergeFields;d<p.length;d++){var y=ma(e,p[d],n);if(!s.contains(y))throw new c(a.INVALID_ARGUMENT,"Field '"+y+"' is specified in your field mask but missing from your input data.");Ia(l,y)||l.push(y)}u=new C(l),h=s.fieldTransforms.filter((function(t){return u.covers(t.field)}))}else u=null,h=s.fieldTransforms;return new $u(new ot(f),u,h)}var ia=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(s.c)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Dc)throw 1===t.Dc?t.$c(this._methodName+"() can only appear at the top level of your update data"):t.$c(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(Hu);function oa(t,e,n){return new ta({Dc:3,Lc:e.settings.Lc,methodName:t._methodName,xc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var sa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(s.c)(e,t),e.prototype._toFieldTransform=function(t){return new se(t.path,new Jt)},e.prototype.isEqual=function(t){return t instanceof e},e}(Hu),ua=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).qc=n,r}return Object(s.c)(e,t),e.prototype._toFieldTransform=function(t){var e=oa(this,t,!0),n=this.qc.map((function(t){return da(t,e)})),r=new Zt(n);return new se(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Hu),aa=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).qc=n,r}return Object(s.c)(e,t),e.prototype._toFieldTransform=function(t){var e=oa(this,t,!0),n=this.qc.map((function(t){return da(t,e)})),r=new ee(n);return new se(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Hu),ca=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return Object(s.c)(e,t),e.prototype._toFieldTransform=function(t){var e=new re(t.R,Wt(t.R,this.Uc));return new se(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(Hu);function ha(t,e,n,i){var o=t.Bc(1,e,n);va("Data must be an object, but it was:",o,i);var s=[],u=ot.empty();D(i,(function(t,i){var a=ba(e,t,n);i=Object(r.p)(i);var c=o.kc(a);if(i instanceof ia)s.push(a);else{var h=da(i,c);null!=h&&(s.push(a),u.set(a,h))}}));var a=new C(s);return new Ju(u,a,o.fieldTransforms)}function fa(t,e,n,i,o,s){var u=t.Bc(1,e,n),h=[ma(e,i,n)],f=[o];if(s.length%2!=0)throw new c(a.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var l=0;l<s.length;l+=2)h.push(ma(e,s[l])),f.push(s[l+1]);for(var d=[],p=ot.empty(),y=h.length-1;y>=0;--y)if(!Ia(d,h[y])){var v=h[y],m=f[y];m=Object(r.p)(m);var g=u.kc(v);if(m instanceof ia)d.push(v);else{var b=da(m,g);null!=b&&(d.push(v),p.set(v,b))}}var w=new C(d);return new Ju(p,w,u.fieldTransforms)}function la(t,e,n,r){return void 0===r&&(r=!1),da(n,t.Bc(r?4:3,e))}function da(t,e){if(ya(t=Object(r.p)(t)))return va("Unsupported field value:",e,t),pa(t,e);if(t instanceof Hu)return function(t,e){if(!Zu(e.Dc))throw e.$c(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.$c(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xc&&4!==e.Dc)throw e.$c("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=da(o[i],e.Oc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(r.p)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Wt(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=T.fromDate(t);return{timestampValue:en(e.R,n)}}if(t instanceof T)return n=new T(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:en(e.R,n)};if(t instanceof Yu)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Wu)return{bytesValue:nn(e.R,t._byteString)};if(t instanceof ku){n=e.databaseId;var i=t.firestore._databaseId;if(!i.isEqual(n))throw e.$c("Document reference is for database "+i.projectId+"/"+i.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:sn(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.$c("Unsupported field value: "+Ou(t))}(t,e)}function pa(t,e){var n={};return N(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):D(t,(function(t,r){var i=da(r,e.Nc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function ya(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof T||t instanceof Yu||t instanceof Wu||t instanceof ku||t instanceof Hu)}function va(t,e,n){if(!ya(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=Ou(n);throw"an object"===r?e.$c(t+" a custom object"):e.$c(t+" "+r)}}function ma(t,e,n){if((e=Object(r.p)(e))instanceof zu)return e._internalPath;if("string"==typeof e)return ba(t,e);throw wa("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var ga=new RegExp("[~\\*/\\[\\]]");function ba(t,e,n){if(e.search(ga)>=0)throw wa("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(zu.bind.apply(zu,Object(s.f)([void 0],e.split(".")))))._internalPath}catch(r){throw wa("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function wa(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,u="Function "+e+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var h="";return(o||s)&&(h+=" (found",o&&(h+=" in field "+r),s&&(h+=" in document "+i),h+=")"),new c(a.INVALID_ARGUMENT,(u+=". ")+t+h)}function Ia(t,e){return t.some((function(t){return t.isEqual(e)}))}var _a=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new ku(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new Ea(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.toProto())}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(Ta("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),Ea=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(s.c)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(_a);function Ta(t,e){return"string"==typeof e?ba(t,e):e instanceof zu?e._internalPath:e._delegate._internalPath}var Oa=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Sa=function(t){function e(e,n,r,i,o,s){var u=this;return(u=t.call(this,e,n,r,i,s)||this)._firestore=e,u._firestoreImpl=e,u.metadata=o,u}return Object(s.c)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Da(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.toProto(),t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(Ta("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(_a),Da=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(s.c)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(Sa),Na=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Oa(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach((function(r){t.call(e,new Da(n._firestore,n._userDataWriter,r.key,r,new Oa(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query._converter))}))},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new c(a.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map((function(e){var r=new Da(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Oa(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query._converter);return e.doc,{type:"added",doc:r,oldIndex:-1,newIndex:n++}}))}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new Da(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Oa(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query._converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Aa(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function Aa(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return v()}}function ka(t,e){return t instanceof Sa&&e instanceof Sa?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Na&&e instanceof Na&&t._firestore===e._firestore&&Pu(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function ja(t){if(xt(t)&&0===t.explicitOrderBy.length)throw new c(a.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var xa=function(){};function Ca(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var Ra=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qc=e,i.Kc=n,i.jc=r,i.type="where",i}return Object(s.c)(e,t),e.prototype._apply=function(t){var e=na(t.firestore),n=function(t,e,n,r,i,o,s){var u;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new c(a.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Ua(s,o);for(var h=[],f=0,l=s;f<l.length;f++){var d=l[f];h.push(Va(r,t,d))}u={arrayValue:{values:h}}}else u=Va(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Ua(s,o),u=la(n,"where",s,"in"===o||"not-in"===o);var p=dt.create(i,o,u);return function(t,e){if(e.g()){var n=Rt(t);if(null!==n&&!n.isEqual(e.field))throw new c(a.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Ct(t);null!==r&&Ba(t,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new c(a.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new c(a.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,p),p}(t._query,0,e,t.firestore._databaseId,this.Qc,this.Kc,this.jc);return new ju(t.firestore,t._converter,function(t,e){var n=t.filters.concat([e]);return new Nt(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(xa),La=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Qc=e,r.Wc=n,r.type="orderBy",r}return Object(s.c)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new c(a.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new c(a.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Tt(e,n);return function(t,e){if(null===Ct(t)){var n=Rt(t);null!==n&&Ba(t,n,e.field)}}(t,r),r}(t._query,this.Qc,this.Wc);return new ju(t.firestore,t._converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new Nt(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(xa),Pa=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Gc=n,i.zc=r,i}return Object(s.c)(e,t),e.prototype._apply=function(t){return new ju(t.firestore,t._converter,Ft(t._query,this.Gc,this.zc))},e}(xa),Ma=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return Object(s.c)(e,t),e.prototype._apply=function(t){var e=qa(t,this.type,this.Hc,this.Jc);return new ju(t.firestore,t._converter,function(t,e){return new Nt(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(xa),Fa=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return Object(s.c)(e,t),e.prototype._apply=function(t){var e=qa(t,this.type,this.Hc,this.Jc);return new ju(t.firestore,t._converter,function(t,e){return new Nt(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(xa);function qa(t,e,n,i){if(n[0]=Object(r.p)(n[0]),n[0]instanceof _a)return function(t,e,n,r,i){if(!r)throw new c(a.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,u=Pt(t);s<u.length;s++){var h=u[s];if(h.field.isKeyField())o.push(Z(e,r.key));else{var f=r.data.field(h.field);if(q(f))throw new c(a.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===f){var l=h.field.canonicalString();throw new c(a.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+l+"' (used as the orderBy) does not exist.")}o.push(f)}}return new _t(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,i);var o=na(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new c(a.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],h=0;h<i.length;h++){var f=i[h];if(s[h].field.isKeyField()){if("string"!=typeof f)throw new c(a.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof f);if(!Lt(t)&&-1!==f.indexOf("/"))throw new c(a.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+f+"' contains a slash.");var l=t.path.child(k.fromString(f));if(!Q.isDocumentKey(l))throw new c(a.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+l+"' is not because it contains an odd number of segments.");var d=new Q(l);u.push(Z(e,d))}else{var p=la(n,r,f);u.push(p)}}return new _t(u,o)}(t._query,t.firestore._databaseId,o,e,n,i)}function Va(t,e,n){if("string"==typeof(n=Object(r.p)(n))){if(""===n)throw new c(a.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Lt(e)&&-1!==n.indexOf("/"))throw new c(a.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var i=e.path.child(k.fromString(n));if(!Q.isDocumentKey(i))throw new c(a.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+i+"' is not because it has an odd number of segments ("+i.length+").");return Z(t,new Q(i))}if(n instanceof ku)return Z(t,n._key);throw new c(a.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Ou(n)+".")}function Ua(t,e){if(!Array.isArray(t)||0===t.length)throw new c(a.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new c(a.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Ba(t,e,n){if(!n.isEqual(e))throw new c(a.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var Ka=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),z(t)){case 0:return null;case 1:return t.booleanValue;case 2:return M(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(F(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw v()}},t.prototype.convertObject=function(t,e){var n=this,r={};return D(t.fields||{},(function(t,i){r[t]=n.convertValue(i,e)})),r},t.prototype.convertGeoPoint=function(t){return new Yu(M(t.latitude),M(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.convertValue(t,e)}))},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=V(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(U(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=P(t);return new T(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=k.fromString(t);m(jn(n));var r=new du(n.get(1),n.get(3)),i=new Q(n.popFirst(5));return r.isEqual(e)||d("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function Ga(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Qa=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(s.c)(e,t),e.prototype.convertBytes=function(t){return new Wu(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new ku(this.firestore,null,e)},e}(Ka),za=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=na(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=Wa(t,this._firestore),i=Ga(r._converter,e,n),o=ra(this._dataReader,"WriteBatch.set",r._key,i,null!==r._converter,n);return this._mutations.push(o.toMutation(r._key,ae.none())),this},t.prototype.update=function(t,e,n){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];this._verifyNotCommitted();var s,u=Wa(t,this._firestore);return s="string"==typeof(e=Object(r.p)(e))||e instanceof zu?fa(this._dataReader,"WriteBatch.update",u._key,e,n,i):ha(this._dataReader,"WriteBatch.update",u._key,e),this._mutations.push(s.toMutation(u._key,ae.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=Wa(t,this._firestore);return this._mutations=this._mutations.concat(new Ee(e._key,ae.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new c(a.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function Wa(t,e){if((t=Object(r.p)(t)).firestore!==e)throw new c(a.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Ha=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(s.c)(e,t),e.prototype.convertBytes=function(t){return new Wu(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new ku(this.firestore,null,e)},e}(Ka);function Ya(t,e,n){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];t=Su(t,ku);var s=Su(t.firestore,Uu),u=na(s);return $a(s,[("string"==typeof(e=Object(r.p)(e))||e instanceof zu?fa(u,"updateDoc",t._key,e,n,i):ha(u,"updateDoc",t._key,e)).toMutation(t._key,ae.exists(!0))])}function Xa(t){for(var e,n,i,o=[],u=1;u<arguments.length;u++)o[u-1]=arguments[u];t=Object(r.p)(t);var a={includeMetadataChanges:!1},c=0;"object"!=typeof o[c]||Fu(o[c])||(a=o[c],c++);var h,f,l,d={includeMetadataChanges:a.includeMetadataChanges};if(Fu(o[c])){var p=o[c];o[c]=null===(e=p.next)||void 0===e?void 0:e.bind(p),o[c+1]=null===(n=p.error)||void 0===n?void 0:n.bind(p),o[c+2]=null===(i=p.complete)||void 0===i?void 0:i.bind(p)}if(t instanceof ku)f=Su(t.firestore,Uu),l=kt(t._key.path),h={next:function(e){o[c]&&o[c](Ja(f,t,e))},error:o[c+1],complete:o[c+2]};else{var y=Su(t,ju);f=Su(y.firestore,Uu),l=y._query;var v=new Ha(f);h={next:function(t){o[c]&&o[c](new Na(f,v,y,t))},error:o[c+1],complete:o[c+2]},ja(t._query)}return function(t,e,n,r){var i=this,o=new Xs(r),u=new ns(e,o,n);return t.asyncQueue.enqueueAndForget((function(){return Object(s.b)(i,void 0,void 0,(function(){var e;return Object(s.d)(this,(function(n){switch(n.label){case 0:return e=$o,[4,cu(t)];case 1:return[2,e.apply(void 0,[n.sent(),u])]}}))}))})),function(){o.Wo(),t.asyncQueue.enqueueAndForget((function(){return Object(s.b)(i,void 0,void 0,(function(){var e;return Object(s.d)(this,(function(n){switch(n.label){case 0:return e=Jo,[4,cu(t)];case 1:return[2,e.apply(void 0,[n.sent(),u])]}}))}))}))}}(Bu(f),l,d,h)}function $a(t,e){return function(t,e){var n=this,r=new er;return t.asyncQueue.enqueueAndForget((function(){return Object(s.b)(n,void 0,void 0,(function(){var n;return Object(s.d)(this,(function(i){switch(i.label){case 0:return n=vs,[4,au(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(Bu(t),e)}function Ja(t,e,n){var r=n.docs.get(e._key),i=new Ha(t);return new Sa(t,i,e._key,r,new Oa(n.hasPendingWrites,n.fromCache),e._converter)}var Za=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return Object(s.c)(e,t),e.prototype.get=function(e){var n=this,r=Wa(e,this._firestore),i=new Ha(this._firestore);return t.prototype.get.call(this,e).then((function(t){return new Sa(n._firestore,i,r._key,t._document,new Oa(!1,!1),r._converter)}))},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=na(t)}return t.prototype.get=function(t){var e=this,n=Wa(t,this._firestore),r=new Qa(this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return v();var i=t[0];if(i.isFoundDocument())return new _a(e._firestore,r,i.key,i,n._converter);if(i.isNoDocument())return new _a(e._firestore,r,n._key,null,n._converter);throw v()}))},t.prototype.set=function(t,e,n){var r=Wa(t,this._firestore),i=Ga(r._converter,e,n),o=ra(this._dataReader,"Transaction.set",r._key,i,null!==r._converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s,u=Wa(t,this._firestore);return s="string"==typeof(e=Object(r.p)(e))||e instanceof zu?fa(this._dataReader,"Transaction.update",u._key,e,n,i):ha(this._dataReader,"Transaction.update",u._key,e),this._transaction.update(u._key,s),this},t.prototype.delete=function(t){var e=Wa(t,this._firestore);return this._transaction.delete(e._key),this},t}());function tc(){if("undefined"==typeof Uint8Array)throw new c(a.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function ec(){if("undefined"==typeof atob)throw new c(a.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var nc=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return ec(),new t(Wu.fromBase64String(e))},t.fromUint8Array=function(e){return tc(),new t(Wu.fromUint8Array(e))},t.prototype.toBase64=function(){return ec(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return tc(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),rc=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Qu(t=Su(t,Uu));var n=Bu(t),r=t._freezeSettings(),i=new Hs;return Gu(n,i,new zs(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Qu(t=Su(t,Uu));var e=Bu(t),n=t._freezeSettings(),r=new Hs;return Gu(e,r,new Ws(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new c(a.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new er;return t._queue.enqueueAndForgetEvenWhileRestricted((function(){return Object(s.b)(e,void 0,void 0,(function(){var e;return Object(s.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(s.b)(this,void 0,void 0,(function(){var e;return Object(s.d)(this,(function(n){switch(n.label){case 0:return ir.yt()?(e=t+"main",[4,ir.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(yi(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t._delegate)},t}(),ic=function(){function t(t,e,n){var r=this;this._delegate=e,this.Yc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof du||(this.Xc=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._delegate._getSettings()),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e){!function(t,e,n){var r=(t=Su(t,Au))._getSettings();"firestore.googleapis.com"!==r.host&&r.host!==e&&p("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},r),{host:e+":"+n,ssl:!1}))}(this._delegate,t,e)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return Object(s.b)(e,void 0,void 0,(function(){var e,n;return Object(s.d)(this,(function(r){switch(r.label){case 0:return[4,ou(t)];case 1:return e=r.sent(),[4,uu(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=g(t);return e.$r.delete(0),bo(e)}(n))]}}))}))}))}(Bu(Su(this._delegate,Uu)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return Object(s.b)(e,void 0,void 0,(function(){var e,n;return Object(s.d)(this,(function(r){switch(r.label){case 0:return[4,ou(t)];case 1:return e=r.sent(),[4,uu(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return Object(s.b)(this,void 0,void 0,(function(){var e;return Object(s.d)(this,(function(n){switch(n.label){case 0:return(e=g(t)).$r.add(0),[4,wo(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(Bu(Su(this._delegate,Uu)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&_u("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Yc.enableMultiTabIndexedDbPersistence(this):this.Yc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Yc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.Xc&&(this.Xc._removeServiceInstance("firestore"),this.Xc._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new er;return t.asyncQueue.enqueueAndForget((function(){return Object(s.b)(e,void 0,void 0,(function(){var e;return Object(s.d)(this,(function(r){switch(r.label){case 0:return e=_s,[4,au(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(Bu(Su(this._delegate,Uu)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new Xs(e);return t.asyncQueue.enqueueAndForget((function(){return Object(s.b)(n,void 0,void 0,(function(){var e;return Object(s.d)(this,(function(n){switch(n.label){case 0:return e=function(t,e){g(t).Gr.add(e),e.next()},[4,cu(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))})),function(){r.Wo(),t.asyncQueue.enqueueAndForget((function(){return Object(s.b)(n,void 0,void 0,(function(){var e;return Object(s.d)(this,(function(n){switch(n.label){case 0:return e=function(t,e){g(t).Gr.delete(e)},[4,cu(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))}))}}(Bu(t=Su(t,Uu)),Fu(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.Xc)throw new c(a.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Xc},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new bc(this,Cu(this._delegate,t))}catch(t){throw fc(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new hc(this,Ru(this._delegate,t))}catch(t){throw fc(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new vc(this,function(t,e){if(t=Su(t,Au),wu("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new c(a.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new ju(t,null,function(t){return new Nt(k.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw fc(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new er;return t.asyncQueue.enqueueAndForget((function(){return Object(s.b)(n,void 0,void 0,(function(){var n;return Object(s.d)(this,(function(i){switch(i.label){case 0:return[4,function(t){return iu(t).then((function(t){return t.datastore}))}(t)];case 1:return n=i.sent(),new Zs(t.asyncQueue,n,e,r).run(),[2]}}))}))})),r.promise}(Bu(t),(function(n){return e(new Za(t,n))}))}(this._delegate,(function(n){return t(new uc(e,n))}))},t.prototype.batch=function(){var t=this;return Bu(this._delegate),new ac(new za(this._delegate,(function(e){return $a(t._delegate,e)})))},t.prototype.loadBundle=function(t){throw new c(a.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new c(a.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),oc=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(s.c)(e,t),e.prototype.convertBytes=function(t){return new nc(new Wu(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return hc.Zc(e,this.firestore,null)},e}(Ka);function sc(t){var e;e=t,h.setLogLevel(e)}var uc=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new oc(t)}return t.prototype.get=function(t){var e=this,n=wc(t);return this._delegate.get(n).then((function(t){return new pc(e._firestore,new Sa(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n._converter))}))},t.prototype.set=function(t,e,n){var r=wc(t);return n?(Iu("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var u=wc(t);return 2===arguments.length?this._delegate.update(u,e):(r=this._delegate).update.apply(r,Object(s.f)([u,e,n],i)),this},t.prototype.delete=function(t){var e=wc(t);return this._delegate.delete(e),this},t}(),ac=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=wc(t);return n?(Iu("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var u=wc(t);return 2===arguments.length?this._delegate.update(u,e):(r=this._delegate).update.apply(r,Object(s.f)([u,e,n],i)),this},t.prototype.delete=function(t){var e=wc(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),cc=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new Da(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new yc(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.tu=function(e,n){var r=t.eu,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new oc(e),n),i.set(n,o)),o},t}();cc.eu=new WeakMap;var hc=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new oc(t)}return t.nu=function(e,n,r){if(e.length%2!=0)throw new c(a.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new ku(n._delegate,r,new Q(e)))},t.Zc=function(e,n,r){return new t(n,new ku(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new bc(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new bc(this.firestore,Cu(this._delegate,t))}catch(t){throw fc(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=Object(r.p)(t))instanceof ku&&Lu(this._delegate,t)},t.prototype.set=function(t,e){e=Iu("DocumentReference.set",e);try{return function(t,e,n){t=Su(t,ku);var r=Su(t.firestore,Uu),i=Ga(t._converter,e,n);return $a(r,[ra(na(r),"setDoc",t._key,i,null!==t._converter,n).toMutation(t._key,ae.none())])}(this._delegate,t,e)}catch(t){throw fc(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Ya(this._delegate,t):Ya.apply(void 0,Object(s.f)([this._delegate,t,e],n))}catch(t){throw fc(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return $a(Su((t=this._delegate).firestore,Uu),[new Ee(t._key,ae.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=lc(e),i=dc(e,(function(e){return new pc(t.firestore,new Sa(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate._converter))}));return Xa(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Su(t,ku);var e=Su(t.firestore,Uu),n=Bu(e),r=new Ha(e);return function(t,e){var n=this,r=new er;return t.asyncQueue.enqueueAndForget((function(){return Object(s.b)(n,void 0,void 0,(function(){var n;return Object(s.d)(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(s.b)(this,void 0,void 0,(function(){var r,i;return Object(s.d)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=g(t);return n.persistence.runTransaction("read document","readonly",(function(t){return n.Mn.mn(t,e)}))}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new c(a.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=Qo(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}}))}))},[4,su(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._key).then((function(n){return new Sa(e,r,t._key,n,new Oa(null!==n&&n.hasLocalMutations,!0),t._converter)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Su(t,ku);var e=Su(t.firestore,Uu);return hu(Bu(e),t._key,{source:"server"}).then((function(n){return Ja(e,t,n)}))}(this._delegate):function(t){t=Su(t,ku);var e=Su(t.firestore,Uu);return hu(Bu(e),t._key).then((function(n){return Ja(e,t,n)}))}(this._delegate)).then((function(t){return new pc(e.firestore,new Sa(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate._converter))}))},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(cc.tu(this.firestore,e)):this._delegate.withConverter(null))},t}();function fc(t,e,n){return t.message=t.message.replace(e,n),t}function lc(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!Fu(r))return r}return{}}function dc(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=Fu(t[0])?t[0]:Fu(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var pc=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new hc(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return ka(this._delegate,t._delegate)},t}(),yc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(s.c)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(pc),vc=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new oc(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Ca(this._delegate,function(t,e,n){var r=e,i=Ta("where",t);return new Ra(i,r,n)}(e,n,r)))}catch(e){throw fc(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Ca(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=Ta("orderBy",t);return new La(r,n)}(e,n)))}catch(e){throw fc(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,Ca(this._delegate,function(t){return Du("limit",t),new Pa("limit",t,"F")}(e)))}catch(e){throw fc(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Ca(this._delegate,function(t){return Du("limitToLast",t),new Pa("limitToLast",t,"L")}(e)))}catch(e){throw fc(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Ca(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ma("startAt",t,!0)}.apply(void 0,e)))}catch(e){throw fc(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Ca(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ma("startAfter",t,!1)}.apply(void 0,e)))}catch(e){throw fc(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Ca(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Fa("endBefore",t,!0)}.apply(void 0,e)))}catch(e){throw fc(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Ca(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Fa("endAt",t,!1)}.apply(void 0,e)))}catch(e){throw fc(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return Pu(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Su(t,ju);var e=Su(t.firestore,Uu),n=Bu(e),r=new Ha(e);return function(t,e){var n=this,r=new er;return t.asyncQueue.enqueueAndForget((function(){return Object(s.b)(n,void 0,void 0,(function(){var n;return Object(s.d)(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(s.b)(this,void 0,void 0,(function(){var r,i,o,u,a;return Object(s.d)(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,ki(t,e,!0)];case 1:return a=s.sent(),r=new cs(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return u=s.sent(),a=Qo(u,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}}))}))},[4,su(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._query).then((function(n){return new Na(e,r,t,n)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Su(t,ju);var e=Su(t.firestore,Uu),n=Bu(e),r=new Ha(e);return fu(n,t._query,{source:"server"}).then((function(n){return new Na(e,r,t,n)}))}(this._delegate):function(t){t=Su(t,ju);var e=Su(t.firestore,Uu),n=Bu(e),r=new Ha(e);return ja(t._query),fu(n,t._query).then((function(n){return new Na(e,r,t,n)}))}(this._delegate)).then((function(t){return new gc(e.firestore,new Na(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}))},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=lc(e),i=dc(e,(function(e){return new gc(t.firestore,new Na(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))}));return Xa(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(cc.tu(this.firestore,e)):this._delegate.withConverter(null))},t}(),mc=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new yc(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),gc=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new vc(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map((function(e){return new yc(t._firestore,e)}))},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map((function(t){return new mc(e._firestore,t)}))},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach((function(r){t.call(e,new yc(n._firestore,r))}))},t.prototype.isEqual=function(t){return ka(this._delegate,t._delegate)},t}(),bc=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return Object(s.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new hc(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new hc(this.firestore,void 0===t?Ru(this._delegate):Ru(this._delegate,t))}catch(t){throw fc(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=Su(t.firestore,Uu),r=Ru(t),i=Ga(t._converter,e);return $a(n,[ra(na(t.firestore),"addDoc",r._key,i,null!==t._converter,{}).toMutation(r._key,ae.exists(!1))]).then((function(){return r}))}(this._delegate,t).then((function(t){return new hc(e.firestore,t)}))},e.prototype.isEqual=function(t){return Lu(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,t?this._delegate.withConverter(cc.tu(this.firestore,t)):this._delegate.withConverter(null))},e}(vc);function wc(t){return Su(t,ku)}var Ic=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(zu.bind.apply(zu,Object(s.f)([void 0],t)))}return t.documentId=function(){return new t(x.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=Object(r.p)(t))instanceof zu&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),_c=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new sa("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new ia("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ua("arrayUnion",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new aa("arrayRemove",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new ca("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}();function Ec(t){return function(t,e){var n=Bu(t=Su(t,Uu)),r=new qu;return function(t,e,n,r){var i=this,o=function(t,e){return function(t,e){return new $s(t,e)}(function(t,e){if(t instanceof Uint8Array)return Ys(t,e);if(t instanceof ArrayBuffer)return Ys(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof t?(new TextEncoder).encode(t):t),e)}(n,ho(e));t.asyncQueue.enqueueAndForget((function(){return Object(s.b)(i,void 0,void 0,(function(){var e;return Object(s.d)(this,(function(n){switch(n.label){case 0:return e=Gs,[4,au(t)];case 1:return e.apply(void 0,[n.sent(),o,r]),[2]}}))}))}))}(n,t._databaseId,e,r),r}(this._delegate,t)}function Tc(t){var e,n,r=this;return(e=this._delegate,n=t,function(t,e){var n=this;return t.asyncQueue.enqueue((function(){return Object(s.b)(n,void 0,void 0,(function(){var n;return Object(s.d)(this,(function(r){switch(r.label){case 0:return n=function(t,e){var n=g(t);return n.persistence.runTransaction("Get named query","readonly",(function(t){return n.Qe.getNamedQuery(t,e)}))},[4,su(t)];case 1:return[2,n.apply(void 0,[r.sent(),e])]}}))}))}))}(Bu(e=Su(e,Uu)),n).then((function(t){return t?new ju(e,null,t.query):null}))).then((function(t){return t?new vc(r,t):null}))}}).call(this,n("8oxB"))}}]);